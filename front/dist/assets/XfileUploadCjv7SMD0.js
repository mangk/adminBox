import"./XvueDq6FxnTE.js";import{i as e,b as l,f as a}from"./XfileUploadCiTTH9xU.js";import{u as t,s as o}from"./XindexBmDFXdea.js";import{E as s,a as i}from"./Xelement-plusK_CVChsI.js";import{b as u,ah as r,o as n,c as p,a as d,J as v,X as m,Q as c,V as f,F as g,a8 as y,P as h,U as x,u as j,K as X,W as b}from"./X@vueDkxIAGiu.js";import"./XpiniaCIH0lQhM.js";import"./X@element-plusCEsRLdgl.js";import"./XaxiosDtE8dZ3W.js";import"./XmittCNZ6avp8.js";import"./Xvue-routerCciq6Mc4.js";import"./XnprogressCIdgZ774.js";import"./Xcos-js-sdk-v5B2H1ItxU.js";import"./Xvue3-sfc-loaderDa78GGQm.js";import"./Xlodash-esBg5u8xPa.js";import"./X@vueuse4nPxBlH-.js";import"./X@popperjsD3lHDW-0.js";import"./X@ctrlD2oWfImC.js";import"./XdayjsBsZV2HIa.js";import"./Xasync-validatorCuo4gI4y.js";import"./Xmemoize-oneDs0C_khL.js";import"./Xnormalize-wheel-esVn5vHDCm.js";import"./X@floating-uipMauM7H8.js";const w={style:{padding:"0px var(--global-padding)"}},z={key:0},_={style:{display:"flex","flex-flow":"row wrap",padding:"var(--global-padding)"}},k=["onMouseleave","onMouseover","onClick"],C={style:{"font-size":"30px","text-align":"center",margin:"var(--global-padding)","margin-bottom":"0"}},V={style:{"font-size":"12px","line-height":"12px",padding:"3px","text-align":"center"}},U={style:{"font-size":"12px","line-height":"12px",padding:"3px",position:"absolute",left:"0",top:"0","background-color":"#409eff",color:"#fff","border-radius":"0 0 5px 0"}},O={class:"el-upload__text",style:{height:"60px","line-height":"60px","text-align":"center",overflow:"hidden",display:"flex","flex-flow":"row nowrap","justify-content":"center"}},A=d("em",null,"点击上传",-1),P={__name:"fileUpload",props:{modelValue:{type:[String,Array],required:!0,default:""},selected:{type:Function,required:!1,default:()=>{}},multiple:{type:Number,default:1},suffixList:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(P,{emit:M}){const $=u({}),B=u("default"),F=t(),S=P,q=M,J=u(S.modelValue);if(Array.isArray(J.value)){let e=[];for(const l in J.value)if(Object.prototype.hasOwnProperty.call(J.value,l)){const a=J.value[l];a&&e.push(a)}J.value=e}else J.value?J.value=[J.value]:J.value=[];const L=()=>{let e=[];for(const l in J.value)if(Object.prototype.hasOwnProperty.call(J.value,l)){const a=J.value[l];e.push(a)}1==S.multiple&&(e=e[0]),q("update:modelValue",e),S.selected&&S.selected(e),T.value=!1},T=u(!1),D=e=>{for(const l in J.value)if(Object.prototype.hasOwnProperty.call(J.value,l)){const a=J.value[l];if(a&&a==e.url)return"img-item-select"}},E=(e,l,a)=>{G()},K=u([]),N=u(1),Q=u(25),W=u(0),G=()=>{l(N.value,Q.value,{tag:S.suffixList}).then((e=>{K.value=e.data.list,N.value=e.data.page,Q.value=e.data.page_size,W.value=e.data.total}))},H=e=>{Q.value=e,G()},I=e=>{N.value=e,G()},R=u(0),Y=()=>{a().then((e=>{$.value=e.data})),G(),T.value=!0},Z=()=>{T.value=!1};return(l,a)=>{const t=r("UploadFilled"),u=r("el-icon"),P=r("el-button"),M=r("el-radio-button"),q=r("el-radio-group"),ee=r("CircleClose"),le=r("Document"),ae=r("el-image"),te=r("el-pagination"),oe=r("upload-filled"),se=r("el-upload"),ie=r("el-drawer");return n(),p(g,null,[d("div",{class:"upload-file-slot",onClick:Y},[v(l.$slots,"default",{},(()=>[m(P,{type:"primary"},{default:c((()=>[m(u,null,{default:c((()=>[m(t)])),_:1}),f(" 文件上传 ")])),_:1})]))]),m(ie,{modelValue:T.value,"onUpdate:modelValue":a[3]||(a[3]=e=>T.value=e),direction:"rtl","before-close":Z,"show-close":!0,"append-to-body":"",size:"50%",style:{"max-width":"600px"}},{header:c((()=>[d("div",w,[m(P,{type:"primary",onClick:L},{default:c((()=>[f("确定")])),_:1}),Object.keys($.value).length>1?(n(),p("div",z,[m(q,{modelValue:B.value,"onUpdate:modelValue":a[0]||(a[0]=e=>B.value=e),size:"small"},{default:c((()=>[(n(!0),p(g,null,y($.value,((e,l)=>(n(),h(M,{label:e.name,value:e.driver,key:e.driver},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])):x("",!0)])])),footer:c((()=>[m(te,{"current-page":N.value,"onUpdate:currentPage":a[1]||(a[1]=e=>N.value=e),"page-size":Q.value,"onUpdate:pageSize":a[2]||(a[2]=e=>Q.value=e),"page-sizes":[20,50,100,200],size:"small",layout:"total, prev, pager, next",total:W.value,onSizeChange:H,onCurrentChange:I},null,8,["current-page","page-size","total"]),m(se,{drag:"",action:`${j(o)()}sys/fileUpload/upload?driver=${B.value}`,headers:{Authorization:"Bearer "+j(F).userAuth().token},"show-file-list":!1,multiple:"","on-success":E},{default:c((()=>[d("div",O,[m(u,{class:"el-icon--upload",style:{"font-size":"35px",margin:"10px var(--global-padding) 0 0"}},{default:c((()=>[m(oe)])),_:1}),f(" 将文件拖到此处或"),A])])),_:1},8,["action","headers"])])),default:c((()=>[d("div",_,[(n(!0),p(g,null,y(K.value,((l,a)=>(n(),p("div",{class:X(["img-item",D(l)]),onMouseleave:e=>(l.id,void(R.value=0)),onMouseover:e=>{return a=l.id,void(R.value=a);var a},onClick:e=>(e=>{let l=!1;for(let a=0;a<J.value.length;a++){const t=J.value[a];t&&t==e.url&&(J.value.splice(a,1),l=!0)}J.value.length>=S.multiple?s({type:"warning",message:`最多选择 ${S.multiple} 个`}):l||J.value.push(e.url)})(l)},[R.value==l.id?(n(),h(u,{key:0,class:"img-del",onClick:a=>(l=>{i.confirm("删除文件?","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e(l.id).then((e=>{G();for(let a=0;a<J.value.length;a++)J.value[a]==l.url&&J.value.splice(a,1)}))}))})(l)},{default:c((()=>[m(ee)])),_:2},1032,["onClick"])):x("",!0),m(ae,{style:{width:"100%"},src:l.url,fit:"scale-down",lazy:""},{error:c((()=>[d("div",C,[m(u,{style:{"font-size":"28px"}},{default:c((()=>[m(le)])),_:1})]),d("div",V,b(l.name.split(".")[0]),1),d("div",U,b(l.name.split(".")[1]),1)])),_:2},1032,["src"])],42,k)))),256))])])),_:1},8,["modelValue"])],64)}}};export{P as default};
