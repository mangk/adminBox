import{J as V,u as ne,N as U,r as u,f as n,o as c,c as m,e as w,R as se,d as s,w as d,g as $,F as S,z as F,j as E,k as N,q as ue,n as de,S as ie}from"./Xindex8fzL0qgV.js";const O=window.adminX?window.adminX:{},M=O.BackendPrefix?"/"+O.BackendPrefix:"",re=()=>V({url:M+"/sys/fileUpload/cfg",method:"GET"}),ce=(r=1,x=20,i={})=>V({url:M+"/sys/fileUpload/page",method:"POST",data:{page:r,page_size:x,query:i}}),pe=r=>V({url:M+"/sys/fileUpload",method:"DELETE",data:{id:r}}),ve={style:{display:"flex","flex-flow":"row wrap",padding:"var(--global-padding)"}},fe=["onMouseleave","onMouseover"],me={key:0},ge={class:"el-upload__text",style:{height:"40px","line-height":"40px","text-align":"center",overflow:"hidden",display:"flex","flex-flow":"row nowrap","justify-content":"center"}},_e=w("em",null,"点击上传",-1),we={__name:"fileUpload",props:{modelValue:{},modelModifiers:{},multiple:{default:1,type:Number},multipleModifiers:{},type:{default:"obj",type:String},typeModifiers:{}},emits:["update:modelValue","update:multiple","update:type"],setup(r){const x=ne(),i=U(r,"modelValue"),g=U(r,"multiple"),j=U(r,"type"),l=u([]),C=u({}),k=u("default"),_=u(!1),h=window.adminX?window.adminX:{},A=(h.RunAt?h.RunAt:"")+(h.BackendPrefix?"/"+h.BackendPrefix:""),B=u([]),p=u(1),v=u(25),P=u(0),f=()=>{ce(p.value,v.value).then(e=>{B.value=e.data.list,p.value=e.data.page,v.value=e.data.page_size,P.value=e.data.total})},D=e=>{if(g.value==1){l.value.length&&l.value[0].id==e.id?l.value=[]:l.value=[e],i.value=l.value;return}for(let a=0;a<l.value.length;a++)if(l.value[a].id==e.id){l.value.splice(a,1),i.value=l.value;return}if(l.value.length>=g.value){ie({type:"warning",message:`最多选择 ${g.value} 个`});return}l.value.push(e),i.value=l.value},T=e=>{for(const a in l.value)if(Object.hasOwnProperty.call(l.value,a)&&l.value[a].id==e)return"img-item-select"},X=(e,a,o)=>{f()},z=u(0),L=e=>{z.value=0},R=e=>{z.value=e},q=e=>{pe(e).then(a=>{for(let o=0;o<l.value.length;o++)if(l.value[o].id==e){l.value.splice(o,1),i.value=l.value;return}console.log("删除",e),f()})},I=e=>{v.value=e,f()},G=e=>{p.value=e,f()},H=()=>{re().then(e=>{C.value=e.data}),f(),_.value=!0},J=()=>{if(j.value=="string")if(g.value==1)i.value=l.value[0].url;else{let e=[];for(let a=0;a<l.value.length;a++){const o=l.value[a];e.push(o.url)}i.value=e}_.value=!1};return(e,a)=>{const o=n("UploadFilled"),y=n("el-icon"),K=n("el-button"),Q=n("el-pagination"),W=n("CircleClose"),Y=n("el-image"),Z=n("el-radio-button"),ee=n("el-radio-group"),le=n("upload-filled"),ae=n("el-upload"),te=n("el-drawer");return c(),m(S,null,[w("div",{class:"upload-file-slot",onClick:H},[se(e.$slots,"default",{},()=>[s(K,{type:"primary"},{default:d(()=>[s(y,null,{default:d(()=>[s(o)]),_:1}),$(" 文件上传 ")]),_:1})])]),s(te,{modelValue:_.value,"onUpdate:modelValue":a[3]||(a[3]=t=>_.value=t),direction:"rtl","before-close":J,"show-close":!1,size:"50%;"},{header:d(()=>[s(Q,{"current-page":p.value,"onUpdate:currentPage":a[0]||(a[0]=t=>p.value=t),"page-size":v.value,"onUpdate:pageSize":a[1]||(a[1]=t=>v.value=t),"page-sizes":[20,50,100,200],size:"small",layout:"total, prev, pager, next",total:P.value,onSizeChange:I,onCurrentChange:G},null,8,["current-page","page-size","total"])]),footer:d(()=>[Object.keys(C.value).length>1?(c(),m("div",me,[s(ee,{modelValue:k.value,"onUpdate:modelValue":a[2]||(a[2]=t=>k.value=t),size:"small"},{default:d(()=>[(c(!0),m(S,null,F(C.value,(t,oe)=>(c(),E(Z,{label:t.name,value:t.driver,key:t.driver},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):N("",!0),s(ae,{drag:"",action:`${A}/sys/fileUpload/upload?driver=${k.value}`,headers:{Authorization:"Bearer "+ue(x).token()},"show-file-list":!1,multiple:"","on-success":X},{default:d(()=>[w("div",ge,[s(y,{class:"el-icon--upload",style:{"font-size":"35px",margin:"0 var(--global-padding) 0 0"}},{default:d(()=>[s(le)]),_:1}),$(" 将文件拖到此处或"),_e])]),_:1},8,["action","headers"])]),default:d(()=>[w("div",ve,[(c(!0),m(S,null,F(B.value,(t,oe)=>(c(),m("div",{class:de(["img-item",T(t.id)]),onMouseleave:b=>L(t.id),onMouseover:b=>R(t.id)},[z.value==t.id?(c(),E(y,{key:0,class:"img-del",onClick:b=>q(t.id)},{default:d(()=>[s(W)]),_:2},1032,["onClick"])):N("",!0),s(Y,{style:{width:"100%"},src:t.url,fit:"scale-down",lazy:"",onClick:b=>D(t)},null,8,["src","onClick"])],42,fe))),256))])]),_:1},8,["modelValue"])],64)}}};export{we as default};
