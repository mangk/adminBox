import"./XvueBaz_cZdj.js";import{h as e,u as l,s as a}from"./XindexBl4KmUQR.js";import{E as t,a as o}from"./Xelement-plusCLM398fa.js";import{b as i,ah as s,o as u,c as r,a as n,J as p,X as d,Q as v,V as m,F as c,a8 as f,P as g,U as y,u as h,K as x,W as j}from"./X@vuen9TiMG2O.js";import"./XpiniaYeQOi8UL.js";import"./X@element-plusBnJF7_W-.js";import"./XaxiosByKc3Ecy.js";import"./XmittCNZ6avp8.js";import"./Xvue-routerzsXVQF6n.js";import"./XnprogressDgs0sPf-.js";import"./Xdayjst441MSVg.js";import"./Xvue3-sfc-loaderDa78GGQm.js";import"./Xlodash-esBg5u8xPa.js";import"./X@vueuseCCX6pF6_.js";import"./X@popperjsD3lHDW-0.js";import"./X@ctrlD2oWfImC.js";import"./Xasync-validatorCuo4gI4y.js";import"./Xmemoize-oneDs0C_khL.js";import"./Xnormalize-wheel-esVn5vHDCm.js";import"./X@floating-uipMauM7H8.js";const b={style:{padding:"0px var(--global-padding)"}},X={key:0},w={style:{display:"flex","flex-flow":"row wrap",padding:"var(--global-padding)"}},z=["onMouseleave","onMouseover","onClick"],_={style:{"font-size":"30px","text-align":"center",margin:"var(--global-padding)","margin-bottom":"0"}},k={style:{"font-size":"12px","line-height":"12px",padding:"3px","text-align":"center"}},C={style:{"font-size":"12px","line-height":"12px",padding:"3px",position:"absolute",left:"0",top:"0","background-color":"#409eff",color:"#fff","border-radius":"0 0 5px 0"}},U={class:"el-upload__text",style:{height:"60px","line-height":"60px","text-align":"center",overflow:"hidden",display:"flex","flex-flow":"row nowrap","justify-content":"center"}},V=n("em",null,"点击上传",-1),O={__name:"fileUpload",props:{modelValue:{type:[String,Array],required:!0,default:""},selected:{type:Function,required:!1,default:()=>{}},multiple:{type:Number,default:1},suffixList:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(O,{emit:A}){const P=i({}),E=i("default"),T=l(),M=O,S=A,$=i(M.modelValue);if(Array.isArray($.value)){let e=[];for(const l in $.value)if(Object.prototype.hasOwnProperty.call($.value,l)){const a=$.value[l];a&&e.push(a)}$.value=e}else $.value?$.value=[$.value]:$.value=[];const q=()=>{let e=[];for(const l in $.value)if(Object.prototype.hasOwnProperty.call($.value,l)){const a=$.value[l];e.push(a)}1==M.multiple&&(e=e[0]),S("update:modelValue",e),M.selected&&M.selected(e),B.value=!1},B=i(!1),F=e=>{for(const l in $.value)if(Object.prototype.hasOwnProperty.call($.value,l)){const a=$.value[l];if(a&&a==e.url)return"img-item-select"}},L=(e,l,a)=>{Q()},D=l=>{o.confirm("删除文件?","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{var a;(a=l.id,e({url:"/sys/fileUpload",method:"DELETE",data:{id:a}})).then((e=>{Q();for(let a=0;a<$.value.length;a++){$.value[a]==l.url&&$.value.splice(a,1)}}))}))},G=i([]),J=i(1),K=i(25),N=i(0),Q=()=>{((l=1,a=20,t={})=>e({url:"/sys/fileUpload/page",method:"POST",data:{page:l,page_size:a,query:t}}))(J.value,K.value,{tag:M.suffixList}).then((e=>{G.value=e.data.list,J.value=e.data.page,K.value=e.data.page_size,N.value=e.data.total}))},W=e=>{K.value=e,Q()},H=e=>{J.value=e,Q()},I=i(0),R=()=>{e({url:"/sys/fileUpload/cfg",method:"GET"}).then((e=>{P.value=e.data})),Q(),B.value=!0},Y=()=>{B.value=!1};return(e,l)=>{const o=s("UploadFilled"),i=s("el-icon"),O=s("el-button"),A=s("el-radio-button"),S=s("el-radio-group"),Q=s("CircleClose"),Z=s("Document"),ee=s("el-image"),le=s("el-pagination"),ae=s("upload-filled"),te=s("el-upload"),oe=s("el-drawer");return u(),r(c,null,[n("div",{class:"upload-file-slot",onClick:R},[p(e.$slots,"default",{},(()=>[d(O,{type:"primary"},{default:v((()=>[d(i,null,{default:v((()=>[d(o)])),_:1}),m(" 文件上传 ")])),_:1})]))]),d(oe,{modelValue:B.value,"onUpdate:modelValue":l[3]||(l[3]=e=>B.value=e),direction:"rtl","before-close":Y,"show-close":!0,"append-to-body":"",size:"50%",style:{"max-width":"600px"}},{header:v((()=>[n("div",b,[d(O,{type:"primary",onClick:q},{default:v((()=>[m("确定")])),_:1}),Object.keys(P.value).length>1?(u(),r("div",X,[d(S,{modelValue:E.value,"onUpdate:modelValue":l[0]||(l[0]=e=>E.value=e),size:"small"},{default:v((()=>[(u(!0),r(c,null,f(P.value,((e,l)=>(u(),g(A,{label:e.name,value:e.driver,key:e.driver},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])):y("",!0)])])),footer:v((()=>[d(le,{"current-page":J.value,"onUpdate:currentPage":l[1]||(l[1]=e=>J.value=e),"page-size":K.value,"onUpdate:pageSize":l[2]||(l[2]=e=>K.value=e),"page-sizes":[20,50,100,200],size:"small",layout:"total, prev, pager, next",total:N.value,onSizeChange:W,onCurrentChange:H},null,8,["current-page","page-size","total"]),d(te,{drag:"",action:`${h(a)()}/sys/fileUpload/upload?driver=${E.value}`,headers:{Authorization:"Bearer "+h(T).userAuth().token},"show-file-list":!1,multiple:"","on-success":L},{default:v((()=>[n("div",U,[d(i,{class:"el-icon--upload",style:{"font-size":"35px",margin:"10px var(--global-padding) 0 0"}},{default:v((()=>[d(ae)])),_:1}),m(" 将文件拖到此处或"),V])])),_:1},8,["action","headers"])])),default:v((()=>[n("div",w,[(u(!0),r(c,null,f(G.value,((e,l)=>(u(),r("div",{class:x(["img-item",F(e)]),onMouseleave:l=>(e.id,void(I.value=0)),onMouseover:l=>{return a=e.id,void(I.value=a);var a},onClick:l=>(e=>{let l=!1;for(let a=0;a<$.value.length;a++){const t=$.value[a];t&&t==e.url&&($.value.splice(a,1),l=!0)}$.value.length>=M.multiple?t({type:"warning",message:`最多选择 ${M.multiple} 个`}):l||$.value.push(e.url)})(e)},[I.value==e.id?(u(),g(i,{key:0,class:"img-del",onClick:l=>D(e)},{default:v((()=>[d(Q)])),_:2},1032,["onClick"])):y("",!0),d(ee,{style:{width:"100%"},src:e.url,fit:"scale-down",lazy:""},{error:v((()=>[n("div",_,[d(i,{style:{"font-size":"28px"}},{default:v((()=>[d(Z)])),_:1})]),n("div",k,j(e.name.split(".")[0]),1),n("div",C,j(e.name.split(".")[1]),1)])),_:2},1032,["src"])],42,z)))),256))])])),_:1},8,["modelValue"])],64)}}};export{O as default};
