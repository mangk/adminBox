import"./XvueDq6FxnTE.js";import{Q as e}from"./X@element-plusCEsRLdgl.js";import{d as l,a,b as t,c as i,e as o}from"./Xdepartmentf1m2VMS8.js";import d from"./XpremissionSetwJM44Ltb.js";import{_ as r}from"./X_plugin-vue_export-helperBCo6x5W8.js";import{b as s,$ as n,j as p,ah as m,o as u,c,X as f,Q as v,V as h,P as _,U as j,a as b,i as y}from"./X@vueDkxIAGiu.js";import"./XindexC-mZv1cw.js";import"./XpiniaCIH0lQhM.js";import"./Xelement-plusK_CVChsI.js";import"./Xlodash-esBg5u8xPa.js";import"./X@vueuse4nPxBlH-.js";import"./X@popperjsD3lHDW-0.js";import"./X@ctrlD2oWfImC.js";import"./XdayjsBsZV2HIa.js";import"./Xcos-js-sdk-v5B2H1ItxU.js";import"./Xasync-validatorCuo4gI4y.js";import"./Xmemoize-oneDs0C_khL.js";import"./Xnormalize-wheel-esVn5vHDCm.js";import"./X@floating-uipMauM7H8.js";import"./XaxiosDtE8dZ3W.js";import"./XmittCNZ6avp8.js";import"./Xvue-routerCciq6Mc4.js";import"./XnprogressCIdgZ774.js";import"./Xvue3-sfc-loaderDa78GGQm.js";const X={class:"main-content"},g={class:"dialog-footer"},w=r({__name:"department",setup(r){const{proxy:w}=y(),k=s(0),V=s(!1),C=s([]),x=n([]);for(const[l]of Object.entries(e))x.push({key:l.__name,label:l.__name});const U=s(),z=n({id:0,pid:"",name:"",description:""}),E=n({pid:[{required:!0,trigger:"blur",validator:(e,l,a)=>{""!==l?l!==z.id?a():a(new Error("所选部门不能为当前编辑部门")):a(new Error("父级部门 不能为空"))}}],name:[{required:!0,message:"路由名称 不能为空",trigger:"blur"}]}),I=e=>{V.value=!1,$(e)},$=e=>{e&&e.resetFields()},D=(e=!1)=>{e?(z.id=e,t(e).then((e=>{0===e.code&&(z.pid=e.data.pid,z.name=e.data.name,z.description=e.data.description)}))):z.id=0,F(),V.value=!0},P=()=>{o().then((e=>{C.value=e.data}))},q=s([{id:0,name:"根目录"}]),F=()=>{q.value=[{id:0,name:"根目录"}],Q(C.value,q.value,!1)},Q=(e,l,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const t={name:e.name,id:e.id,disabled:a||e.id===z.id,children:[]};Q(e.children,t.children,a||e.id===z.id),l.push(t)}else{const t={name:e.name,id:e.id,disabled:a||e.id===z.id};l.push(t)}}))};return p((()=>{P()})),(e,t)=>{const o=m("Plus"),r=m("el-icon"),s=m("el-button"),n=m("el-form-item"),p=m("el-table-column"),y=m("Edit"),x=m("Filter"),F=m("Delete"),Q=m("el-popconfirm"),S=m("el-table"),L=m("el-cascader"),O=m("el-input"),R=m("el-form"),T=m("el-dialog");return u(),c("div",X,[f(n,{label:""},{default:v((()=>[f(s,{type:"primary",onClick:t[0]||(t[0]=e=>D())},{default:v((()=>[f(r,null,{default:v((()=>[f(o)])),_:1}),h(" 新建部门 ")])),_:1})])),_:1}),f(S,{data:C.value,"row-key":"id",height:"var(--global-table)",border:"","highlight-current-row":"","show-overflow-tooltip":"","default-expand-all":"",width:"80vw","append-to-body":""},{default:v((()=>[f(p,{prop:"id",label:"ID",sortable:"",fixed:""}),f(p,{prop:"name",label:"部门名称"}),f(p,{prop:"description",label:"部门简介"}),f(p,{fixed:"right",label:"操作",width:"200"},{default:v((e=>[f(s,{link:"",type:"primary",size:"small",onClick:l=>D(e.row.id)},{default:v((()=>[f(r,null,{default:v((()=>[f(y)])),_:1}),h(" 编辑 ")])),_:2},1032,["onClick"]),f(s,{link:"",type:"primary",size:"small",onClick:l=>k.value=e.row.id},{default:v((()=>[f(r,null,{default:v((()=>[f(x)])),_:1}),h(" 权限设置 ")])),_:2},1032,["onClick"]),e.row.children?j("",!0):(u(),_(Q,{key:0,title:"删除后不可恢复，确定删除菜单【"+e.row.name+"】?",onConfirm:l=>{var a;(a=e.row.id)?i(a).then((e=>{0===e.code&&(w.$message.success(e.msg),P())})):w.$message.error("请选择数据ID")},width:"200"},{reference:v((()=>[f(s,{link:"",type:"primary",size:"small"},{default:v((()=>[f(r,null,{default:v((()=>[f(F)])),_:1}),h(" 删除 ")])),_:1})])),_:2},1032,["title","onConfirm"]))])),_:1})])),_:1},8,["data"]),f(T,{modelValue:V.value,"onUpdate:modelValue":t[7]||(t[7]=e=>V.value=e),title:z.id?"编辑部门":"新建部门",width:"80vw","append-to-body":"",onClose:t[8]||(t[8]=e=>I(U.value))},{footer:v((()=>[b("div",g,[f(s,{onClick:t[4]||(t[4]=e=>$(U.value))},{default:v((()=>[h("重置")])),_:1}),f(s,{onClick:t[5]||(t[5]=e=>I(U.value))},{default:v((()=>[h("取消")])),_:1}),f(s,{type:"primary",onClick:t[6]||(t[6]=e=>(async e=>{e&&await e.validate(((t,i)=>{if(t){let t={};t=z.id?l(z):a(z),t.then((l=>{0===l.code&&(w.$message.success(l.msg),P(),V.value=!1,$(e))}))}}))})(U.value))},{default:v((()=>[h("保存")])),_:1})])])),default:v((()=>[f(R,{ref_key:"formRef",ref:U,model:z,rules:E,"status-icon":"","label-position":"top","show-all-levels":!1,inline:""},{default:v((()=>[f(n,{label:"父级部门",prop:"pid",style:{width:"40%"}},{default:v((()=>[f(L,{modelValue:z.pid,"onUpdate:modelValue":t[1]||(t[1]=e=>z.pid=e),options:q.value,props:{expandTrigger:"hover",checkStrictly:!0,value:"id",label:"name",emitPath:!1},style:{width:"100%"}},null,8,["modelValue","options"])])),_:1}),f(n,{label:"部门名称",prop:"name",style:{width:"40%"}},{default:v((()=>[f(O,{modelValue:z.name,"onUpdate:modelValue":t[2]||(t[2]=e=>z.name=e)},null,8,["modelValue"])])),_:1}),f(n,{label:"部门简介",prop:"description",style:{width:"40%"}},{default:v((()=>[f(O,{modelValue:z.description,"onUpdate:modelValue":t[3]||(t[3]=e=>z.description=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),f(d,{modelValue:k.value,"onUpdate:modelValue":t[9]||(t[9]=e=>k.value=e),type:"sys_department"},null,8,["modelValue"])])}}},[["__scopeId","data-v-02d6f74c"]]);export{w as default};
