import"./XvueVe3_Elhr.js";import{Q as e}from"./X@element-plusCerOoRDG.js";import{d as l,a,b as t,c as i,e as o}from"./Xdepartmentnta1LWq_.js";import d from"./XpremissionSetDyALD3TM.js";import{_ as r}from"./X_plugin-vue_export-helperBCo6x5W8.js";import{e as s,k as n,m as p,al as m,o as u,c,Q as f,I as v,M as h,H as _,L as j,a as b,l as y}from"./X@vueCM7II4So.js";import"./Xindex3lybcBch.js";import"./XpiniaHbUHA5wR.js";import"./Xelement-plusCO1bik-q.js";import"./Xlodash-esBCrAzI1e.js";import"./X@vueuseDU8TvUvn.js";import"./X@popperjsD3lHDW-0.js";import"./X@ctrlD2oWfImC.js";import"./XdayjsBLCVIqfw.js";import"./Xcos-js-sdk-v5B2H1ItxU.js";import"./Xasync-validatorCuo4gI4y.js";import"./Xmemoize-oneDs0C_khL.js";import"./Xnormalize-wheel-esVn5vHDCm.js";import"./X@floating-uipMauM7H8.js";import"./XaxiosBh_nfBBj.js";import"./XmittCNZ6avp8.js";import"./Xvue-routerCYJBVSJE.js";import"./XnprogressCIdgZ774.js";import"./Xvue3-sfc-loaderDa78GGQm.js";const g={class:"main-content"},w={class:"dialog-footer"},X=r({__name:"department",setup(r){const{proxy:X}=y(),k=s(0),V=s(!1),C=s([]),x=n([]);for(const[l]of Object.entries(e))x.push({key:l.__name,label:l.__name});const z=s(),I=n({id:0,pid:"",name:"",description:""}),U=n({pid:[{required:!0,trigger:"blur",validator:(e,l,a)=>{""!==l?l!==I.id?a():a(new Error("所选部门不能为当前编辑部门")):a(new Error("父级部门 不能为空"))}}],name:[{required:!0,message:"路由名称 不能为空",trigger:"blur"}]}),E=e=>{V.value=!1,D(e)},D=e=>{e&&e.resetFields()},$=(e=!1)=>{e?(I.id=e,t(e).then((e=>{0===e.code&&(I.pid=e.data.pid,I.name=e.data.name,I.description=e.data.description)}))):I.id=0,L(),V.value=!0},q=()=>{o().then((e=>{C.value=e.data}))},F=s([{id:0,name:"根目录"}]),L=()=>{F.value=[{id:0,name:"根目录"}],P(C.value,F.value,!1)},P=(e,l,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const t={name:e.name,id:e.id,disabled:a||e.id===I.id,children:[]};P(e.children,t.children,a||e.id===I.id),l.push(t)}else{const t={name:e.name,id:e.id,disabled:a||e.id===I.id};l.push(t)}}))};return p((()=>{q()})),(e,t)=>{const o=m("Plus"),r=m("el-icon"),s=m("el-button"),n=m("el-form-item"),p=m("el-table-column"),y=m("Edit"),x=m("Filter"),L=m("Delete"),P=m("el-popconfirm"),Q=m("el-table"),S=m("el-cascader"),H=m("el-input"),M=m("el-form"),O=m("el-dialog");return u(),c("div",g,[f(n,{label:""},{default:v((()=>[f(s,{type:"primary",onClick:t[0]||(t[0]=e=>$())},{default:v((()=>[f(r,null,{default:v((()=>[f(o)])),_:1}),h(" 新建部门 ")])),_:1})])),_:1}),f(Q,{data:C.value,"row-key":"id",height:"var(--global-table)",border:"","highlight-current-row":"","show-overflow-tooltip":"","default-expand-all":"",width:"80vw","append-to-body":""},{default:v((()=>[f(p,{prop:"id",label:"ID",sortable:"",fixed:""}),f(p,{prop:"name",label:"部门名称"}),f(p,{prop:"description",label:"部门简介"}),f(p,{fixed:"right",label:"操作",width:"200"},{default:v((e=>[f(s,{link:"",type:"primary",size:"small",onClick:l=>$(e.row.id)},{default:v((()=>[f(r,null,{default:v((()=>[f(y)])),_:1}),h(" 编辑 ")])),_:2},1032,["onClick"]),f(s,{link:"",type:"primary",size:"small",onClick:l=>k.value=e.row.id},{default:v((()=>[f(r,null,{default:v((()=>[f(x)])),_:1}),h(" 权限设置 ")])),_:2},1032,["onClick"]),e.row.children?j("",!0):(u(),_(P,{key:0,title:"删除后不可恢复，确定删除菜单【"+e.row.name+"】?",onConfirm:l=>{var a;(a=e.row.id)?i(a).then((e=>{0===e.code&&(X.$message.success(e.msg),q())})):X.$message.error("请选择数据ID")},width:"200"},{reference:v((()=>[f(s,{link:"",type:"primary",size:"small"},{default:v((()=>[f(r,null,{default:v((()=>[f(L)])),_:1}),h(" 删除 ")])),_:1})])),_:2},1032,["title","onConfirm"]))])),_:1})])),_:1},8,["data"]),f(O,{modelValue:V.value,"onUpdate:modelValue":t[7]||(t[7]=e=>V.value=e),title:I.id?"编辑部门":"新建部门",width:"80vw","append-to-body":"",onClose:t[8]||(t[8]=e=>E(z.value))},{footer:v((()=>[b("div",w,[f(s,{onClick:t[4]||(t[4]=e=>D(z.value))},{default:v((()=>[h("重置")])),_:1}),f(s,{onClick:t[5]||(t[5]=e=>E(z.value))},{default:v((()=>[h("取消")])),_:1}),f(s,{type:"primary",onClick:t[6]||(t[6]=e=>(async e=>{e&&await e.validate(((t,i)=>{if(t){let t={};t=I.id?l(I):a(I),t.then((l=>{0===l.code&&(X.$message.success(l.msg),q(),V.value=!1,D(e))}))}}))})(z.value))},{default:v((()=>[h("保存")])),_:1})])])),default:v((()=>[f(M,{ref_key:"formRef",ref:z,model:I,rules:U,"status-icon":"","label-position":"top","show-all-levels":!1,inline:""},{default:v((()=>[f(n,{label:"父级部门",prop:"pid",style:{width:"40%"}},{default:v((()=>[f(S,{modelValue:I.pid,"onUpdate:modelValue":t[1]||(t[1]=e=>I.pid=e),options:F.value,props:{expandTrigger:"hover",checkStrictly:!0,value:"id",label:"name",emitPath:!1},style:{width:"100%"}},null,8,["modelValue","options"])])),_:1}),f(n,{label:"部门名称",prop:"name",style:{width:"40%"}},{default:v((()=>[f(H,{modelValue:I.name,"onUpdate:modelValue":t[2]||(t[2]=e=>I.name=e)},null,8,["modelValue"])])),_:1}),f(n,{label:"部门简介",prop:"description",style:{width:"40%"}},{default:v((()=>[f(H,{modelValue:I.description,"onUpdate:modelValue":t[3]||(t[3]=e=>I.description=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),f(d,{modelValue:k.value,"onUpdate:modelValue":t[9]||(t[9]=e=>k.value=e),type:"sys_department"},null,8,["modelValue"])])}}},[["__scopeId","data-v-02d6f74c"]]);export{X as default};
