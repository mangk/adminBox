import{L as k,r as c,a as O,o as Z,c as d,d as f,e as ee,f as t,w as o,h as s,k as P,t as I,l as V,g as te,j as le}from"./XindexDunG4lwt.js";import{m as ae}from"./XmenuH5v-YDrh.js";const oe=(r=1,g=20,C={})=>k({url:"/sys/setting/api/page",method:"POST",data:{page:r,page_size:g,query:C}}),ne=r=>k({url:"/sys/setting/api/getById",method:"POST",data:{id:r}}),de=r=>k({url:"/sys/setting/api",method:"POST",data:r}),ie=r=>k({url:"/sys/setting/api",method:"PUT",data:r}),re=r=>k({url:"/sys/setting/api",method:"DELETE",data:{id:r}}),se={class:"main-content"},ue={class:"dialog-footer"},ce={__name:"api",setup(r){const{proxy:g}=le(),C=c([]),v=c(1),h=c(20),U=c(0),b=c(!1),y=c(),n=O({id:0,menu_id:0,name:"",description:"",path:"",method:""}),q=O({name:[{required:!0,message:"API名称 不能为空",trigger:"blur"}],path:[{required:!0,message:"API地址 不能为空",trigger:"blur"}],method:[{required:!0,message:"API方法 不能为空",trigger:"blur"}]}),w=()=>{oe(v.value,h.value).then(a=>{C.value=a.data.list,v.value=a.data.page,h.value=a.data.page_size,U.value=a.data.total})},B=a=>{h.value=a,w()},L=a=>{v.value=a,w()},A=(a=!1)=>{a?(n.id=a,ne(a).then(e=>{e.code===0&&(n.id=e.data.id,n.menu_id=e.data.menu_id,n.name=e.data.name,n.description=e.data.description,n.path=e.data.path,n.method=e.data.method)})):n.id=0,G(),b.value=!0},N=a=>{a?re(a).then(e=>{e.code===0&&(g.$message.success(e.msg),w())}):g.$message.error("请选择数据ID"),console.log("del",a)},F=async a=>{a&&await a.validate((e,i)=>{if(!e)console.log("error submit!",i);else{let p={};console.log(n.id),n.id?p=ie(n):p=de(n),p.then(u=>{u.code===0&&(g.$message.success(u.msg),w(),b.value=!1,D(a))})}})},$=a=>{b.value=!1,D(a)},D=a=>{a&&a.resetFields()},z=c(),G=async()=>{ae(!0).then(a=>{z.value=a.data,x(z.value)})},x=(a,e)=>{a&&a.forEach(i=>{i.children&&i.children.length?(i.title=i.meta.title,x(i.children,i.disabled)):i.title=i.meta.title})};return Z(()=>{w()}),(a,e)=>{const i=d("Plus"),p=d("el-icon"),u=d("el-button"),_=d("el-form-item"),m=d("el-table-column"),T=d("el-tag"),j=d("Edit"),M=d("Delete"),R=d("el-popconfirm"),H=d("el-table"),J=d("el-cascader"),S=d("el-input"),E=d("el-option"),K=d("el-select"),Q=d("el-form"),W=d("el-dialog"),X=d("el-pagination");return f(),ee("div",se,[t(_,{label:""},{default:o(()=>[t(u,{type:"primary",onClick:e[0]||(e[0]=l=>A())},{default:o(()=>[t(p,null,{default:o(()=>[t(i)]),_:1}),s(" 新建API ")]),_:1})]),_:1}),t(H,{data:C.value,"row-key":"id",height:"var(--global-table)","header-cell-class-name":"global-el-table-header",border:"","highlight-current-row":"","show-overflow-tooltip":""},{default:o(()=>[t(m,{prop:"id",label:"ID",sortable:"",fixed:"",width:"80"}),t(m,{prop:"name",label:"api名称"}),t(m,{prop:"description",label:"api描述",width:"160"}),t(m,{prop:"path",label:"api路径",width:"260"}),t(m,{label:"方法"},{default:o(l=>[l.row.method==="GET"?(f(),P(T,{key:0,type:"info"},{default:o(()=>[s(I(l.row.method),1)]),_:2},1024)):V("",!0),l.row.method==="POST"?(f(),P(T,{key:1,type:"success"},{default:o(()=>[s(I(l.row.method),1)]),_:2},1024)):V("",!0),l.row.method==="PUT"?(f(),P(T,{key:2,type:"warning"},{default:o(()=>[s(I(l.row.method),1)]),_:2},1024)):V("",!0),l.row.method==="DELETE"?(f(),P(T,{key:3,type:"danger"},{default:o(()=>[s(I(l.row.method),1)]),_:2},1024)):V("",!0)]),_:1}),t(m,{prop:"menu_name",label:"所属菜单",width:"120"}),t(m,{fixed:"right",label:"操作",width:"125"},{default:o(l=>[t(u,{link:"",type:"primary",size:"small",onClick:Y=>A(l.row.id)},{default:o(()=>[t(p,null,{default:o(()=>[t(j)]),_:1}),s(" 编辑 ")]),_:2},1032,["onClick"]),l.row.children?V("",!0):(f(),P(R,{key:0,title:"删除后不可恢复，确定删除API【"+l.row.name+"】?",onConfirm:Y=>N(l.row.id),width:"200"},{reference:o(()=>[t(u,{link:"",type:"primary",size:"small"},{default:o(()=>[t(p,null,{default:o(()=>[t(M)]),_:1}),s(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"]))]),_:1})]),_:1},8,["data"]),t(W,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=l=>b.value=l),title:n.id?"编辑API":"新建API",width:"800",onClose:e[10]||(e[10]=l=>$(y.value))},{footer:o(()=>[te("div",ue,[t(u,{onClick:e[6]||(e[6]=l=>D(y.value))},{default:o(()=>[s("重置")]),_:1}),t(u,{onClick:e[7]||(e[7]=l=>$(y.value))},{default:o(()=>[s("取消")]),_:1}),t(u,{type:"primary",onClick:e[8]||(e[8]=l=>F(y.value))},{default:o(()=>[s("保存")]),_:1})])]),default:o(()=>[t(Q,{ref_key:"formRef",ref:y,model:n,rules:q,"status-icon":"","label-position":"top","show-all-levels":!1},{default:o(()=>[t(_,{label:"父级菜单",prop:"menuId"},{default:o(()=>[t(J,{modelValue:n.menu_id,"onUpdate:modelValue":e[1]||(e[1]=l=>n.menu_id=l),options:z.value,props:{expandTrigger:"hover",checkStrictly:!0,value:"id",label:"title",emitPath:!1},style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),t(_,{label:"API名称",prop:"name"},{default:o(()=>[t(S,{modelValue:n.name,"onUpdate:modelValue":e[2]||(e[2]=l=>n.name=l)},null,8,["modelValue"])]),_:1}),t(_,{label:"API描述",prop:"description"},{default:o(()=>[t(S,{modelValue:n.description,"onUpdate:modelValue":e[3]||(e[3]=l=>n.description=l)},null,8,["modelValue"])]),_:1}),t(_,{label:"API地址",prop:"path"},{default:o(()=>[t(S,{modelValue:n.path,"onUpdate:modelValue":e[4]||(e[4]=l=>n.path=l)},null,8,["modelValue"])]),_:1}),t(_,{label:"API方法",prop:"method"},{default:o(()=>[t(K,{modelValue:n.method,"onUpdate:modelValue":e[5]||(e[5]=l=>n.method=l)},{default:o(()=>[t(E,{label:"GET",value:"GET"}),t(E,{label:"POST",value:"POST"}),t(E,{label:"PUT",value:"PUT"}),t(E,{label:"DELETE",value:"DELETE"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(X,{"current-page":v.value,"onUpdate:currentPage":e[11]||(e[11]=l=>v.value=l),"page-size":h.value,"onUpdate:pageSize":e[12]||(e[12]=l=>h.value=l),"page-sizes":[20,50,100,200],size:"small",layout:"total, sizes, prev, pager, next, jumper",total:U.value,onSizeChange:B,onCurrentChange:L},null,8,["current-page","page-size","total"])])}}};export{ce as default};
