import"./XvueBaz_cZdj.js";import{R as e,S as a,T as l,U as t,c as o,M as n}from"./X@element-plusRXoBkpEf.js";import{f as d,a as s,b as i,c as r,d as u}from"./XfileUploadCNxXkuCX.js";import"./XindexCDrHcQSx.js";import{E as p,a as c}from"./Xelement-plusClartUns.js";import{b as m,ah as v,o as f,c as g,X as h,Q as b,a as y,K as j,W as w,u as X,V as _}from"./X@vuen9TiMG2O.js";import"./XpiniaYeQOi8UL.js";import"./XaxiosDtE8dZ3W.js";import"./XmittCNZ6avp8.js";import"./Xvue-routerzsXVQF6n.js";import"./XnprogressDgs0sPf-.js";import"./Xdayjst441MSVg.js";import"./Xvue3-sfc-loaderDa78GGQm.js";import"./Xlodash-esBg5u8xPa.js";import"./X@vueuseCCX6pF6_.js";import"./X@popperjsD3lHDW-0.js";import"./X@ctrlD2oWfImC.js";import"./Xasync-validatorCuo4gI4y.js";import"./Xmemoize-oneDs0C_khL.js";import"./Xnormalize-wheel-esVn5vHDCm.js";import"./X@floating-uipMauM7H8.js";const x={class:"main-content"},C={class:"file-list-box"},z={__name:"manager",setup(z){const k=m({});d().then((e=>{k.value=e.data}));const U=m([]);s().then((e=>{const a=Array.isArray(e.data)?e.data:[];U.value=a}));const T=m(1),E=m(20),S=m(0),V=m(""),A=m(""),B=m(""),N=m([]),D=m([]),K=(e=!1)=>{e&&(T.value=1,E.value=20);let a={};V.value&&(a.group_id=V.value),A.value&&(a.name=A.value),B.value&&(a.tag=B.value),i(T.value,E.value,a).then((e=>{N.value=e.data.list,T.value=e.data.page,E.value=e.data.page_size,S.value=e.data.total})),D.value=[]},M=e=>{D.value=e.map((e=>e.id))},P=e=>{E.value=e,K()},Q=e=>{T.value=e,K()},R=e=>{e.id?V.value=e.id:V.value="",K(!0)},W=e=>{r(D.value,e.id).then((e=>{0!=e.code?p.error(e.msg):p.success("移动成功"),K()}))},q=async e=>{switch(e){case"downlaod":N.value.forEach((async e=>{if(D.value.includes(e.id)){const a=document.createElement("iframe");a.style.display="none",a.src=e.url+"?attname=",document.body.appendChild(a),setTimeout((()=>{document.body.removeChild(a)}),5e3)}}));break;case"copyUrl":try{let e="";N.value.forEach((a=>{D.value.includes(a.id)&&(e+=a.url+"\n")})),await navigator.clipboard.writeText(e),p({message:"已复制",type:"success"})}catch(a){p({message:"未授权读取剪贴板",type:"error"})}break;case"delete":c.confirm("删除后文件无法找回！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{u(D.value).then((e=>{0==e.code&&p({message:"已删除",type:"success"}),K()}))}))}};return K(),(d,s)=>{const i=v("el-tree"),r=v("el-col"),u=v("el-button"),p=v("el-dropdown-item"),c=v("el-popover"),m=v("el-dropdown-menu"),z=v("el-dropdown"),k=v("el-input"),B=v("el-row"),F=v("el-table-column"),G=v("el-table"),H=v("el-pagination");return f(),g("div",x,[h(B,{gutter:10},{default:b((()=>[h(r,{span:4},{default:b((()=>[h(i,{class:"file-tree-box",data:U.value,props:{label:"name",children:"children"},onNodeClick:R,"default-expand-all":"","expand-on-click-node":!1,draggable:""},{default:b((({node:e,data:a})=>[y("div",{class:j(a.id==V.value?"self-node node-active":"self-node")},w(e.label),3)])),_:1},8,["data"])])),_:1}),h(r,{span:20},{default:b((()=>[y("div",C,[h(B,{style:{display:"flex","justify-content":"space-between"}},{default:b((()=>[y("div",null,[h(u,{type:"primary",icon:X(e)},{default:b((()=>[_(" 上传文件 ")])),_:1},8,["icon"]),h(z,{disabled:!D.value.length,style:{"margin-left":"10px"},onCommand:q},{dropdown:b((()=>[h(m,null,{default:b((()=>[h(p,{command:"downlaod",icon:X(a)},{default:b((()=>[_("下载文件")])),_:1},8,["icon"]),h(p,{command:"copyUrl",icon:X(l)},{default:b((()=>[_("复制链接")])),_:1},8,["icon"]),h(p,{command:"move",icon:X(t)},{default:b((()=>[h(c,{placement:"right",width:300,trigger:"hover"},{reference:b((()=>[_(" 移动到 ")])),default:b((()=>[h(i,{data:U.value,props:{label:"name",children:"children"},onNodeClick:W,"default-expand-all":"","expand-on-click-node":!1,draggable:""},{default:b((({node:e,data:a})=>[_(w(e.label),1)])),_:1},8,["data"])])),_:1})])),_:1},8,["icon"]),h(p,{command:"delete",icon:X(o),divided:""},{default:b((()=>[_("删除")])),_:1},8,["icon"])])),_:1})])),default:b((()=>[h(u,{disabled:!D.value.length},{default:b((()=>[_(" 批量操作 ")])),_:1},8,["disabled"])])),_:1},8,["disabled"])]),h(k,{modelValue:A.value,"onUpdate:modelValue":s[1]||(s[1]=e=>A.value=e),style:{"max-width":"450px"},placeholder:"搜索文件名",clearable:"",class:"input-with-select",onClear:s[2]||(s[2]=e=>K(!0))},{append:b((()=>[h(u,{icon:X(n),onClick:s[0]||(s[0]=e=>K(!0))},null,8,["icon"])])),_:1},8,["modelValue"])])),_:1}),h(G,{data:N.value,"row-key":"id","highlight-current-row":"","show-overflow-tooltip":"",stripe:"",style:{width:"100%","margin-top":"9px","border-top":"1px solid var(--el-table-border-color)",height:"var(--global-table)"},onSelectionChange:M},{default:b((()=>[h(F,{type:"selection",width:"55",fixed:""}),h(F,{prop:"name",label:"文件名",width:"400"}),h(F,{prop:"url",label:"链接",width:"80"}),h(F,{prop:"tag",label:"类型",width:"80"}),h(F,{prop:"group_info.name",label:"分组"}),h(F,{prop:"ct",label:"创建时间",width:"160"})])),_:1},8,["data"]),h(H,{"current-page":T.value,"onUpdate:currentPage":s[3]||(s[3]=e=>T.value=e),"page-size":E.value,"onUpdate:pageSize":s[4]||(s[4]=e=>E.value=e),"page-sizes":[20,50,100,200],size:"small",layout:"total, sizes, prev, pager, next, jumper",total:S.value,onSizeChange:P,onCurrentChange:Q},null,8,["current-page","page-size","total"])])])),_:1})])),_:1})])}}};export{z as default};
