import{K as k,r as c,a as B,o as te,c as d,d as f,e as le,f as t,w as o,h as s,k as P,t as D,l as V,g as ae,j as oe}from"./XindexCutIFmmT.js";import{m as ne}from"./XmenuDyjpT4Dw.js";const q=window.adminX?window.adminX:{},C=q.BackendPrefix?"/"+q.BackendPrefix:"",de=(r=1,g=20,T={})=>k({url:C+"/sys/setting/api/page",method:"POST",data:{page:r,page_size:g,query:T}}),ie=r=>k({url:C+"/sys/setting/api/getById",method:"POST",data:{id:r}}),re=r=>k({url:C+"/sys/setting/api",method:"POST",data:r}),se=r=>k({url:C+"/sys/setting/api",method:"PUT",data:r}),ue=r=>k({url:C+"/sys/setting/api",method:"DELETE",data:{id:r}}),pe={class:"main-content"},me={class:"dialog-footer"},fe={__name:"api",setup(r){const{proxy:g}=oe(),T=c([]),v=c(1),h=c(20),U=c(0),b=c(!1),w=c(),n=B({id:0,menu_id:0,name:"",description:"",path:"",method:""}),L=B({name:[{required:!0,message:"API名称 不能为空",trigger:"blur"}],path:[{required:!0,message:"API地址 不能为空",trigger:"blur"}],method:[{required:!0,message:"API方法 不能为空",trigger:"blur"}]}),y=()=>{de(v.value,h.value).then(a=>{T.value=a.data.list,v.value=a.data.page,h.value=a.data.page_size,U.value=a.data.total})},N=a=>{h.value=a,y()},F=a=>{v.value=a,y()},A=(a=!1)=>{a?(n.id=a,ie(a).then(e=>{e.code===0&&(n.id=e.data.id,n.menu_id=e.data.menu_id,n.name=e.data.name,n.description=e.data.description,n.path=e.data.path,n.method=e.data.method)})):n.id=0,M(),b.value=!0},G=a=>{a?ue(a).then(e=>{e.code===0&&(g.$message.success(e.msg),y())}):g.$message.error("请选择数据ID"),console.log("del",a)},j=async a=>{a&&await a.validate((e,i)=>{if(!e)console.log("error submit!",i);else{let p={};console.log(n.id),n.id?p=se(n):p=re(n),p.then(u=>{u.code===0&&(g.$message.success(u.msg),y(),b.value=!1,x(a))})}})},$=a=>{b.value=!1,x(a)},x=a=>{a&&a.resetFields()},z=c(),M=async()=>{ne(!0).then(a=>{z.value=a.data,O(z.value)})},O=(a,e)=>{a&&a.forEach(i=>{i.children&&i.children.length?(i.title=i.meta.title,O(i.children,i.disabled)):i.title=i.meta.title})};return te(()=>{y()}),(a,e)=>{const i=d("Plus"),p=d("el-icon"),u=d("el-button"),_=d("el-form-item"),m=d("el-table-column"),E=d("el-tag"),R=d("Edit"),X=d("Delete"),K=d("el-popconfirm"),H=d("el-table"),J=d("el-cascader"),S=d("el-input"),I=d("el-option"),Q=d("el-select"),W=d("el-form"),Y=d("el-dialog"),Z=d("el-pagination");return f(),le("div",pe,[t(_,{label:""},{default:o(()=>[t(u,{type:"primary",onClick:e[0]||(e[0]=l=>A())},{default:o(()=>[t(p,null,{default:o(()=>[t(i)]),_:1}),s(" 新建API ")]),_:1})]),_:1}),t(H,{data:T.value,"row-key":"id",height:"var(--global-table)","header-cell-class-name":"global-el-table-header",border:"","highlight-current-row":"","show-overflow-tooltip":""},{default:o(()=>[t(m,{prop:"id",label:"ID",sortable:"",fixed:"",width:"80"}),t(m,{prop:"name",label:"api名称"}),t(m,{prop:"description",label:"api描述",width:"160"}),t(m,{prop:"path",label:"api路径",width:"260"}),t(m,{label:"方法"},{default:o(l=>[l.row.method==="GET"?(f(),P(E,{key:0,type:"info"},{default:o(()=>[s(D(l.row.method),1)]),_:2},1024)):V("",!0),l.row.method==="POST"?(f(),P(E,{key:1,type:"success"},{default:o(()=>[s(D(l.row.method),1)]),_:2},1024)):V("",!0),l.row.method==="PUT"?(f(),P(E,{key:2,type:"warning"},{default:o(()=>[s(D(l.row.method),1)]),_:2},1024)):V("",!0),l.row.method==="DELETE"?(f(),P(E,{key:3,type:"danger"},{default:o(()=>[s(D(l.row.method),1)]),_:2},1024)):V("",!0)]),_:1}),t(m,{prop:"menu_name",label:"所属菜单",width:"120"}),t(m,{fixed:"right",label:"操作",width:"125"},{default:o(l=>[t(u,{link:"",type:"primary",size:"small",onClick:ee=>A(l.row.id)},{default:o(()=>[t(p,null,{default:o(()=>[t(R)]),_:1}),s(" 编辑 ")]),_:2},1032,["onClick"]),l.row.children?V("",!0):(f(),P(K,{key:0,title:"删除后不可恢复，确定删除API【"+l.row.name+"】?",onConfirm:ee=>G(l.row.id),width:"200"},{reference:o(()=>[t(u,{link:"",type:"primary",size:"small"},{default:o(()=>[t(p,null,{default:o(()=>[t(X)]),_:1}),s(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"]))]),_:1})]),_:1},8,["data"]),t(Y,{modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=l=>b.value=l),title:n.id?"编辑API":"新建API",width:"800",onClose:e[10]||(e[10]=l=>$(w.value))},{footer:o(()=>[ae("div",me,[t(u,{onClick:e[6]||(e[6]=l=>x(w.value))},{default:o(()=>[s("重置")]),_:1}),t(u,{onClick:e[7]||(e[7]=l=>$(w.value))},{default:o(()=>[s("取消")]),_:1}),t(u,{type:"primary",onClick:e[8]||(e[8]=l=>j(w.value))},{default:o(()=>[s("保存")]),_:1})])]),default:o(()=>[t(W,{ref_key:"formRef",ref:w,model:n,rules:L,"status-icon":"","label-position":"top","show-all-levels":!1},{default:o(()=>[t(_,{label:"父级菜单",prop:"menuId"},{default:o(()=>[t(J,{modelValue:n.menu_id,"onUpdate:modelValue":e[1]||(e[1]=l=>n.menu_id=l),options:z.value,props:{expandTrigger:"hover",checkStrictly:!0,value:"id",label:"title",emitPath:!1},style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),t(_,{label:"API名称",prop:"name"},{default:o(()=>[t(S,{modelValue:n.name,"onUpdate:modelValue":e[2]||(e[2]=l=>n.name=l)},null,8,["modelValue"])]),_:1}),t(_,{label:"API描述",prop:"description"},{default:o(()=>[t(S,{modelValue:n.description,"onUpdate:modelValue":e[3]||(e[3]=l=>n.description=l)},null,8,["modelValue"])]),_:1}),t(_,{label:"API地址",prop:"path"},{default:o(()=>[t(S,{modelValue:n.path,"onUpdate:modelValue":e[4]||(e[4]=l=>n.path=l)},null,8,["modelValue"])]),_:1}),t(_,{label:"API方法",prop:"method"},{default:o(()=>[t(Q,{modelValue:n.method,"onUpdate:modelValue":e[5]||(e[5]=l=>n.method=l)},{default:o(()=>[t(I,{label:"GET",value:"GET"}),t(I,{label:"POST",value:"POST"}),t(I,{label:"PUT",value:"PUT"}),t(I,{label:"DELETE",value:"DELETE"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(Z,{"current-page":v.value,"onUpdate:currentPage":e[11]||(e[11]=l=>v.value=l),"page-size":h.value,"onUpdate:pageSize":e[12]||(e[12]=l=>h.value=l),"page-sizes":[20,50,100,200],size:"small",layout:"total, sizes, prev, pager, next, jumper",total:U.value,onSizeChange:N,onCurrentChange:F},null,8,["current-page","page-size","total"])])}}};export{fe as default};
