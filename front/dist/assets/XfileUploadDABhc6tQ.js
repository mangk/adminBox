import{J as V,u as de,N as C,r as i,f as n,o as c,c as _,e as p,R as re,d as o,w as u,g as F,F as S,z as L,j as $,k as A,q as ce,n as pe,t as E,S as fe}from"./XindexCZQ8OiDt.js";const N=window.adminX?window.adminX:{},M=N.BackendPrefix?"/"+N.BackendPrefix:"",ve=()=>V({url:M+"/sys/fileUpload/cfg",method:"GET"}),me=(d=1,k=20,r={})=>V({url:M+"/sys/fileUpload/page",method:"POST",data:{page:d,page_size:k,query:r}}),ge=d=>V({url:M+"/sys/fileUpload",method:"DELETE",data:{id:d}}),_e={style:{display:"flex","flex-flow":"row wrap",padding:"var(--global-padding)"}},he=["onMouseleave","onMouseover","onClick"],xe={style:{"font-size":"30px","text-align":"center",margin:"var(--global-padding)","margin-bottom":"0"}},ye={style:{"font-size":"12px","line-height":"12px",padding:"3px","text-align":"center"}},we={style:{"font-size":"12px","line-height":"12px",padding:"3px",position:"absolute",left:"0",top:"0","background-color":"#409eff",color:"#fff","border-radius":"0 0 5px 0"}},Ce={key:0},ke={class:"el-upload__text",style:{height:"40px","line-height":"40px","text-align":"center",overflow:"hidden",display:"flex","flex-flow":"row nowrap","justify-content":"center"}},ze=p("em",null,"点击上传",-1),Pe={__name:"fileUpload",props:{modelValue:{},modelModifiers:{},multiple:{default:1,type:Number},multipleModifiers:{},onlyPath:{default:!1,type:Boolean},onlyPathModifiers:{},suffixList:{default:[],type:Array},suffixListModifiers:{}},emits:["update:modelValue","update:multiple","update:onlyPath","update:suffixList"],setup(d){const k=de(),r=C(d,"modelValue"),h=C(d,"multiple"),O=C(d,"onlyPath"),j=C(d,"suffixList"),l=i([]),z=i({}),b=i("default"),x=i(!1),y=window.adminX?window.adminX:{},T=(y.RunAt?y.RunAt:"")+(y.BackendPrefix?"/"+y.BackendPrefix:""),B=i([]),f=i(1),v=i(25),D=i(0),m=()=>{me(f.value,v.value,{tag:j.value}).then(e=>{B.value=e.data.list,f.value=e.data.page,v.value=e.data.page_size,D.value=e.data.total})},X=e=>{if(h.value==1){l.value.length&&l.value[0].id==e.id?l.value=[]:l.value=[e],r.value=l.value,w();return}for(let t=0;t<l.value.length;t++)if(l.value[t].id==e.id){l.value.splice(t,1),r.value=l.value,w();return}if(l.value.length>=h.value){fe({type:"warning",message:`最多选择 ${h.value} 个`});return}l.value.push(e),r.value=l.value,w()},R=e=>{for(const t in l.value)if(Object.hasOwnProperty.call(l.value,t)&&l.value[t].id==e)return"img-item-select"},q=(e,t,s)=>{m()},U=i(0),I=e=>{U.value=0},G=e=>{U.value=e},H=e=>{ge(e).then(t=>{for(let s=0;s<l.value.length;s++)l.value[s].id==e&&(l.value.splice(s,1),r.value=l.value);m()})},J=e=>{v.value=e,m()},K=e=>{f.value=e,m()},Q=()=>{ve().then(e=>{z.value=e.data}),m(),x.value=!0},W=()=>{w(),x.value=!1},w=()=>{if(l.value.length&&O.value)if(h.value==1)r.value=l.value[0].url;else{let e=[];for(let t=0;t<l.value.length;t++){const s=l.value[t];e.push(s.url)}r.value=e}};return(e,t)=>{const s=n("UploadFilled"),g=n("el-icon"),Y=n("el-button"),Z=n("el-pagination"),ee=n("CircleClose"),le=n("Document"),te=n("el-image"),ae=n("el-radio-button"),oe=n("el-radio-group"),ne=n("upload-filled"),se=n("el-upload"),ue=n("el-drawer");return c(),_(S,null,[p("div",{class:"upload-file-slot",onClick:Q},[re(e.$slots,"default",{},()=>[o(Y,{type:"primary"},{default:u(()=>[o(g,null,{default:u(()=>[o(s)]),_:1}),F(" 文件上传 ")]),_:1})])]),o(ue,{modelValue:x.value,"onUpdate:modelValue":t[3]||(t[3]=a=>x.value=a),direction:"rtl","before-close":W,"show-close":!1,size:"50%;",style:{"max-width":"600px"}},{header:u(()=>[o(Z,{"current-page":f.value,"onUpdate:currentPage":t[0]||(t[0]=a=>f.value=a),"page-size":v.value,"onUpdate:pageSize":t[1]||(t[1]=a=>v.value=a),"page-sizes":[20,50,100,200],size:"small",layout:"total, prev, pager, next",total:D.value,onSizeChange:J,onCurrentChange:K},null,8,["current-page","page-size","total"])]),footer:u(()=>[Object.keys(z.value).length>1?(c(),_("div",Ce,[o(oe,{modelValue:b.value,"onUpdate:modelValue":t[2]||(t[2]=a=>b.value=a),size:"small"},{default:u(()=>[(c(!0),_(S,null,L(z.value,(a,ie)=>(c(),$(ae,{label:a.name,value:a.driver,key:a.driver},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):A("",!0),o(se,{drag:"",action:`${T}/sys/fileUpload/upload?driver=${b.value}`,headers:{Authorization:"Bearer "+ce(k).token()},"show-file-list":!1,multiple:"","on-success":q},{default:u(()=>[p("div",ke,[o(g,{class:"el-icon--upload",style:{"font-size":"35px",margin:"0 var(--global-padding) 0 0"}},{default:u(()=>[o(ne)]),_:1}),F(" 将文件拖到此处或"),ze])]),_:1},8,["action","headers"])]),default:u(()=>[p("div",_e,[(c(!0),_(S,null,L(B.value,(a,ie)=>(c(),_("div",{class:pe(["img-item",R(a.id)]),onMouseleave:P=>I(a.id),onMouseover:P=>G(a.id),onClick:P=>X(a)},[U.value==a.id?(c(),$(g,{key:0,class:"img-del",onClick:P=>H(a.id)},{default:u(()=>[o(ee)]),_:2},1032,["onClick"])):A("",!0),o(te,{style:{width:"100%"},src:a.url,fit:"scale-down",lazy:""},{error:u(()=>[p("div",xe,[o(g,{style:{"font-size":"28px"}},{default:u(()=>[o(le)]),_:1})]),p("div",ye,E(a.name.split(".")[0]),1),p("div",we,E(a.name.split(".")[1]),1)]),_:2},1032,["src"])],42,he))),256))])]),_:1},8,["modelValue"])],64)}}};export{Pe as default};
