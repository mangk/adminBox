import{J as w,r as p,a as F,L as te,f as r,o as x,c as T,d as l,w as o,g as _,j as N,k as ae,e as oe,F as ne,z as re,i as ie}from"./XindexBzdqYFdI.js";import de from"./XpremissionSetBZi_MjU2.js";import{e as se}from"./XdepartmentByKivwPn.js";import{e as ue}from"./XroleBK6QeE8_.js";import me from"./XfileUploadDJoSvH6c.js";import"./X_plugin-vue_export-helperDlAUqK2U.js";const q=window.adminX?window.adminX:{},y=q.BackendPrefix?"/"+q.BackendPrefix:"",pe=(i=1,c=20,V={})=>w({url:y+"/sys/setting/user/page",method:"POST",data:{page:i,page_size:c,query:V}}),_e=i=>w({url:y+"/sys/setting/user/getById",method:"POST",data:{id:i}}),ce=i=>w({url:y+"/sys/setting/user",method:"POST",data:i}),fe=i=>w({url:y+"/sys/setting/user",method:"PUT",data:i}),ge=i=>w({url:y+"/sys/setting/user",method:"DELETE",data:{id:i}}),ve={class:"main-content"},be={class:"dialog-footer"},xe={__name:"user",setup(i){const{proxy:c}=ie(),V=p([]),f=p(1),g=p(20),z=p(0),P=p(0),v=p(!1),b=p(),a=F({id:0,username:"",phone:"",email:"",nick_name:"",avatar:"",department_ids:[],role_ids:[],enable:!0}),A=F({name:[{required:!0,message:"API名称 不能为空",trigger:"blur"}],path:[{required:!0,message:"API地址 不能为空",trigger:"blur"}],method:[{required:!0,message:"API方法 不能为空",trigger:"blur"}]}),$=p([]),D=p([]),h=()=>{pe(f.value,g.value).then(n=>{V.value=n.data.list,f.value=n.data.page,g.value=n.data.page_size,z.value=n.data.total})},E=n=>{g.value=n,h()},O=n=>{f.value=n,h()},I=(n=!1)=>{se().then(e=>{$.value=e.data}),ue().then(e=>{D.value=e.data}),n?(a.id=n,_e(n).then(e=>{e.code===0&&(a.id=e.data.id,a.username=e.data.username,a.phone=e.data.phone,a.email=e.data.email,a.nick_name=e.data.nick_name,a.avatar=e.data.avatar,a.enable=e.data.enable,a.department_ids=e.data.department_ids,a.role_ids=e.data.role_ids)})):a.id=0,v.value=!0},L=n=>{n?ge(n).then(e=>{e.code===0&&(c.$message.success(e.msg),h())}):c.$message.error("请选择数据ID"),console.log("del",n)},j=async n=>{n&&await n.validate((e,k)=>{if(!e)console.log("error submit!",k);else{let s={};a.id?s=fe(a):s=ce(a),s.then(d=>{d.code===0&&(c.$message.success(d.msg),h(),v.value=!1,U(n))})}})},S=n=>{v.value=!1,U(n)},U=n=>{n&&n.resetFields()};return te(()=>{h()}),(n,e)=>{const k=r("Plus"),s=r("el-icon"),d=r("el-button"),u=r("el-form-item"),m=r("el-table-column"),R=r("Edit"),X=r("Filter"),J=r("Delete"),M=r("el-popconfirm"),G=r("el-table"),H=r("el-pagination"),C=r("el-input"),K=r("el-cascader"),Q=r("el-option"),W=r("el-select"),Y=r("el-image"),Z=r("el-switch"),ee=r("el-form"),le=r("el-dialog");return x(),T("div",ve,[l(u,{label:""},{default:o(()=>[l(d,{type:"primary",onClick:e[0]||(e[0]=t=>I())},{default:o(()=>[l(s,null,{default:o(()=>[l(k)]),_:1}),_(" 新增用户 ")]),_:1})]),_:1}),l(G,{data:V.value,"row-key":"id",height:"var(--global-table)","header-cell-class-name":"global-el-table-header",border:"","highlight-current-row":"","show-overflow-tooltip":""},{default:o(()=>[l(m,{prop:"id",label:"ID",sortable:"",fixed:""}),l(m,{prop:"uuid",label:"UUID",width:"300"}),l(m,{prop:"nick_name",label:"昵称",width:"120"}),l(m,{prop:"username",label:"用户名"}),l(m,{prop:"phone",label:"手机号",width:"160"}),l(m,{prop:"email",label:"Email",width:"220"}),l(m,{prop:"avatar",label:"头像",width:"120"}),l(m,{prop:"enable",label:"是否启用",width:"120"}),l(m,{fixed:"right",label:"操作",width:"200"},{default:o(t=>[l(d,{link:"",type:"primary",size:"small",onClick:B=>I(t.row.id)},{default:o(()=>[l(s,null,{default:o(()=>[l(R)]),_:1}),_(" 编辑 ")]),_:2},1032,["onClick"]),l(d,{link:"",type:"primary",size:"small",onClick:B=>P.value=t.row.id},{default:o(()=>[l(s,null,{default:o(()=>[l(X)]),_:1}),_(" 权限设置 ")]),_:2},1032,["onClick"]),t.row.children?ae("",!0):(x(),N(M,{key:0,title:"删除后不可恢复，确定删除API【"+t.row.nickName+"("+t.row.userName+")】?",onConfirm:B=>L(t.row.id),width:"200"},{reference:o(()=>[l(d,{link:"",type:"primary",size:"small"},{default:o(()=>[l(s,null,{default:o(()=>[l(J)]),_:1}),_(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"]))]),_:1})]),_:1},8,["data"]),l(H,{"current-page":f.value,"onUpdate:currentPage":e[1]||(e[1]=t=>f.value=t),"page-size":g.value,"onUpdate:pageSize":e[2]||(e[2]=t=>g.value=t),"page-sizes":[20,50,100,200],size:"small",layout:"total, sizes, prev, pager, next, jumper",total:z.value,onSizeChange:E,onCurrentChange:O},null,8,["current-page","page-size","total"]),l(le,{modelValue:v.value,"onUpdate:modelValue":e[14]||(e[14]=t=>v.value=t),title:a.id?"编辑用户":"新建用户",width:"800",onClose:e[15]||(e[15]=t=>S(b.value))},{footer:o(()=>[oe("div",be,[l(d,{onClick:e[11]||(e[11]=t=>U(b.value))},{default:o(()=>[_("重置")]),_:1}),l(d,{onClick:e[12]||(e[12]=t=>S(b.value))},{default:o(()=>[_("取消")]),_:1}),l(d,{type:"primary",onClick:e[13]||(e[13]=t=>j(b.value))},{default:o(()=>[_("保存")]),_:1})])]),default:o(()=>[l(ee,{ref_key:"formRef",ref:b,model:a,rules:A,"status-icon":"",inline:"","label-position":"top","show-all-levels":!1},{default:o(()=>[l(u,{label:"用户名",prop:"username",style:{width:"40%"}},{default:o(()=>[l(C,{modelValue:a.username,"onUpdate:modelValue":e[3]||(e[3]=t=>a.username=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"手机号",prop:"phone",style:{width:"40%"}},{default:o(()=>[l(C,{modelValue:a.phone,"onUpdate:modelValue":e[4]||(e[4]=t=>a.phone=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"Email",prop:"email",style:{width:"40%"}},{default:o(()=>[l(C,{modelValue:a.email,"onUpdate:modelValue":e[5]||(e[5]=t=>a.email=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"昵称",prop:"nick_name",style:{width:"40%"}},{default:o(()=>[l(C,{modelValue:a.nick_name,"onUpdate:modelValue":e[6]||(e[6]=t=>a.nick_name=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"所属部门",prop:"department_ids",style:{width:"40%"}},{default:o(()=>[l(K,{modelValue:a.department_ids,"onUpdate:modelValue":e[7]||(e[7]=t=>a.department_ids=t),options:$.value,placeholder:"设置用户部门",props:{checkStrictly:!0,expandTrigger:"hover",value:"id",label:"name",multiple:!0,emitPath:!1},style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),l(u,{label:"用户角色",prop:"role_ids",style:{width:"40%"}},{default:o(()=>[l(W,{modelValue:a.role_ids,"onUpdate:modelValue":e[8]||(e[8]=t=>a.role_ids=t),multiple:"",placeholder:"设置用户角色"},{default:o(()=>[(x(!0),T(ne,null,re(D.value,t=>(x(),N(Q,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"头像",prop:"avatar",style:{width:"40%"}},{default:o(()=>[l(Y,{style:{width:"75px",height:"75px",border:"1px dashed var(--el-border-color)","border-radius":"5px"},src:a.avatar,fit:"contain"},null,8,["src"]),l(me,{modelValue:a.avatar,"onUpdate:modelValue":e[9]||(e[9]=t=>a.avatar=t),onlyPath:!0},{default:o(()=>[l(s,{style:{width:"75px",height:"75px",border:"1px dashed var(--el-border-color)","border-radius":"5px","margin-left":"10px"}},{default:o(()=>[l(k)]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"是否启用",prop:"enable",style:{width:"40%"}},{default:o(()=>[l(Z,{modelValue:a.enable,"onUpdate:modelValue":e[10]||(e[10]=t=>a.enable=t),"inline-prompt":"","active-icon":"Check","inactive-icon":"Close"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(de,{modelValue:P.value,"onUpdate:modelValue":e[16]||(e[16]=t=>P.value=t),type:"sys_user"},null,8,["modelValue"])])}}};export{xe as default};
