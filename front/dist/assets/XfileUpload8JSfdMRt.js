import{I as V,u as te,M as P,r as u,f as t,o as i,c as m,e as w,Q as ne,d as n,w as d,g as $,F as b,y as F,j as E,k as O,q as se,n as ue,R as de}from"./XindexBIYJuBvh.js";const A=window.adminX?window.adminX:{},M=A.BackendPrefix?"/"+A.BackendPrefix:"",ie=()=>V({url:M+"/sys/fileUpload/cfg",method:"GET"}),re=(r=1,y=20,c={})=>V({url:M+"/sys/fileUpload/page",method:"POST",data:{page:r,page_size:y,query:c}}),ce=r=>V({url:M+"/sys/fileUpload",method:"DELETE",data:{id:r}}),pe={style:{display:"flex","flex-flow":"row wrap",padding:"var(--global-padding)"}},ve=["onMouseleave","onMouseover"],fe={key:0},me={class:"el-upload__text",style:{height:"40px","line-height":"40px","text-align":"center",overflow:"hidden",display:"flex","flex-flow":"row nowrap","justify-content":"center"}},ge=w("em",null,"点击上传",-1),we={__name:"fileUpload",props:{modelValue:{},modelModifiers:{},multiple:{default:1,type:Number},multipleModifiers:{}},emits:["update:modelValue","update:multiple"],setup(r){const y=te(),c=P(r,"modelValue"),x=P(r,"multiple"),l=u([]),C=u({}),k=u("default"),g=u(!1),_=window.adminX?window.adminX:{},D=(_.RunAt?_.RunAt:"")+(_.BackendPrefix?"/"+_.BackendPrefix:""),S=u([]),p=u(1),v=u(25),B=u(0),f=()=>{re(p.value,v.value).then(e=>{S.value=e.data.list,p.value=e.data.page,v.value=e.data.page_size,B.value=e.data.total})},N=e=>{if(x.value==1){l.value.length&&l.value[0].id==e.id?l.value=[]:l.value=[e],c.value=l.value;return}for(let o=0;o<l.value.length;o++)if(l.value[o].id==e.id){l.value.splice(o,1),c.value=l.value;return}if(l.value.length>=x.value){de({type:"warning",message:`最多选择 ${x.value} 个`});return}l.value.push(e),c.value=l.value},j=e=>{for(const o in l.value)if(Object.hasOwnProperty.call(l.value,o)&&l.value[o].id==e)return"img-item-select"},T=(e,o,s)=>{f()},z=u(0),X=e=>{z.value=0},I=e=>{z.value=e},L=e=>{ce(e).then(o=>{for(let s=0;s<l.value.length;s++)if(l.value[s].id==e){l.value.splice(s,1),c.value=l.value;return}console.log("删除",e),f()})},R=e=>{v.value=e,f()},q=e=>{p.value=e,f()},G=()=>{ie().then(e=>{C.value=e.data}),f(),g.value=!0},H=()=>{g.value=!1};return(e,o)=>{const s=t("UploadFilled"),h=t("el-icon"),Q=t("el-button"),J=t("el-pagination"),K=t("CircleClose"),W=t("el-image"),Y=t("el-radio-button"),Z=t("el-radio-group"),ee=t("upload-filled"),le=t("el-upload"),ae=t("el-drawer");return i(),m(b,null,[w("div",{class:"upload-file-slot",onClick:G},[ne(e.$slots,"default",{},()=>[n(Q,{type:"primary"},{default:d(()=>[n(h,null,{default:d(()=>[n(s)]),_:1}),$(" 文件上传 ")]),_:1})])]),n(ae,{modelValue:g.value,"onUpdate:modelValue":o[3]||(o[3]=a=>g.value=a),direction:"rtl","before-close":H,"show-close":!1,size:"50%;"},{header:d(()=>[n(J,{"current-page":p.value,"onUpdate:currentPage":o[0]||(o[0]=a=>p.value=a),"page-size":v.value,"onUpdate:pageSize":o[1]||(o[1]=a=>v.value=a),"page-sizes":[20,50,100,200],size:"small",layout:"total, prev, pager, next",total:B.value,onSizeChange:R,onCurrentChange:q},null,8,["current-page","page-size","total"])]),footer:d(()=>[Object.keys(C.value).length>1?(i(),m("div",fe,[n(Z,{modelValue:k.value,"onUpdate:modelValue":o[2]||(o[2]=a=>k.value=a),size:"small"},{default:d(()=>[(i(!0),m(b,null,F(C.value,(a,oe)=>(i(),E(Y,{label:a.name,value:a.driver,key:a.driver},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):O("",!0),n(le,{drag:"",action:`${D}/sys/fileUpload/upload?driver=${k.value}`,headers:{Authorization:"Bearer "+se(y).token()},"show-file-list":!1,multiple:"","on-success":T},{default:d(()=>[w("div",me,[n(h,{class:"el-icon--upload",style:{"font-size":"35px",margin:"0 var(--global-padding) 0 0"}},{default:d(()=>[n(ee)]),_:1}),$(" 将文件拖到此处或"),ge])]),_:1},8,["action","headers"])]),default:d(()=>[w("div",pe,[(i(!0),m(b,null,F(S.value,(a,oe)=>(i(),m("div",{class:ue(["img-item",j(a.id)]),onMouseleave:U=>X(a.id),onMouseover:U=>I(a.id)},[z.value==a.id?(i(),E(h,{key:0,class:"img-del",onClick:U=>L(a.id)},{default:d(()=>[n(K)]),_:2},1032,["onClick"])):O("",!0),n(W,{style:{width:"100%"},src:a.url,fit:"scale-down",lazy:"",onClick:U=>N(a)},null,8,["src","onClick"])],42,ve))),256))])]),_:1},8,["modelValue"])],64)}}};export{we as default};
