import{r as d,a as D,o as G,c as s,d as U,e as H,f as l,w as a,h as u,k as J,l as K,g as L,j as O}from"./XindexDSiKo5Vq.js";import{r as Q,a as W,b as X,c as Y,d as Z}from"./XroleqwFPNtFH.js";import ee from"./XpremissionSetV2Xa3DQm.js";import"./X_plugin-vue_export-helperDlAUqK2U.js";const le={class:"main-content"},te={class:"dialog-footer"},re={__name:"role",setup(oe){const g=d(0),{proxy:b}=O(),w=d([]),m=d(1),p=d(20),V=d(0),c=d(!1),f=d(),n=D({id:0,name:"",description:""}),P=D({name:[{required:!0,message:"角色名称 不能为空",trigger:"blur"}]}),_=()=>{Q(m.value,p.value).then(t=>{w.value=t.data.list,m.value=t.data.page,p.value=t.data.page_size,V.value=t.data.total})},S=t=>{p.value=t,_()},F=t=>{m.value=t,_()},z=(t=!1)=>{t?(n.id=t,W(t).then(e=>{e.code===0&&(n.id=e.data.id,n.name=e.data.name,n.description=e.data.description)})):n.id=0,c.value=!0},I=t=>{t?X(t).then(e=>{e.code===0&&(b.$message.success(e.msg),_())}):b.$message.error("请选择数据ID"),console.log("del",t)},B=async t=>{t&&await t.validate((e,y)=>{if(!e)console.log("error submit!",y);else{let r={};console.log(n.id),n.id?r=Y(n):r=Z(n),r.then(i=>{i.code===0&&(b.$message.success(i.msg),_(),c.value=!1,C(t))})}})},$=t=>{c.value=!1,C(t)},C=t=>{t&&t.resetFields()};return G(()=>{_()}),(t,e)=>{const y=s("Plus"),r=s("el-icon"),i=s("el-button"),k=s("el-form-item"),v=s("el-table-column"),N=s("Edit"),j=s("Filter"),q=s("Delete"),R=s("el-popconfirm"),A=s("el-table"),M=s("el-pagination"),h=s("el-input"),T=s("el-form"),E=s("el-dialog");return U(),H("div",le,[l(k,{label:""},{default:a(()=>[l(i,{type:"primary",onClick:e[0]||(e[0]=o=>z())},{default:a(()=>[l(r,null,{default:a(()=>[l(y)]),_:1}),u(" 新建角色 ")]),_:1})]),_:1}),l(A,{data:w.value,"row-key":"id",height:"var(--global-table)","header-cell-class-name":"global-el-table-header",border:"","highlight-current-row":"","show-overflow-tooltip":""},{default:a(()=>[l(v,{prop:"id",label:"ID",sortable:"",fixed:"",width:"80"}),l(v,{prop:"name",label:"角色名称",width:"260"}),l(v,{prop:"description",label:"角色描述"}),l(v,{fixed:"right",label:"操作",width:"200"},{default:a(o=>[l(i,{link:"",type:"primary",size:"small",onClick:x=>z(o.row.id)},{default:a(()=>[l(r,null,{default:a(()=>[l(N)]),_:1}),u(" 编辑 ")]),_:2},1032,["onClick"]),l(i,{link:"",type:"primary",size:"small",onClick:x=>g.value=o.row.id},{default:a(()=>[l(r,null,{default:a(()=>[l(j)]),_:1}),u(" 权限设置 ")]),_:2},1032,["onClick"]),o.row.children?K("",!0):(U(),J(R,{key:0,title:"删除后不可恢复，确定删除API【"+o.row.name+"】?",onConfirm:x=>I(o.row.id),width:"200"},{reference:a(()=>[l(i,{link:"",type:"primary",size:"small"},{default:a(()=>[l(r,null,{default:a(()=>[l(q)]),_:1}),u(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"]))]),_:1})]),_:1},8,["data"]),l(M,{"current-page":m.value,"onUpdate:currentPage":e[1]||(e[1]=o=>m.value=o),"page-size":p.value,"onUpdate:pageSize":e[2]||(e[2]=o=>p.value=o),"page-sizes":[20,50,100,200],size:"small",layout:"total, sizes, prev, pager, next, jumper",total:V.value,onSizeChange:S,onCurrentChange:F},null,8,["current-page","page-size","total"]),l(E,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=o=>c.value=o),title:n.id?"编辑角色":"新建角色",width:"800",onClose:e[9]||(e[9]=o=>$(f.value))},{footer:a(()=>[L("div",te,[l(i,{onClick:e[5]||(e[5]=o=>C(f.value))},{default:a(()=>[u("重置")]),_:1}),l(i,{onClick:e[6]||(e[6]=o=>$(f.value))},{default:a(()=>[u("取消")]),_:1}),l(i,{type:"primary",onClick:e[7]||(e[7]=o=>B(f.value))},{default:a(()=>[u("保存")]),_:1})])]),default:a(()=>[l(T,{ref_key:"formRef",ref:f,model:n,rules:P,"status-icon":"","label-position":"top","show-all-levels":!1},{default:a(()=>[l(k,{label:"角色名称",prop:"name"},{default:a(()=>[l(h,{modelValue:n.name,"onUpdate:modelValue":e[3]||(e[3]=o=>n.name=o)},null,8,["modelValue"])]),_:1}),l(k,{label:"角色描述",prop:"description"},{default:a(()=>[l(h,{modelValue:n.description,"onUpdate:modelValue":e[4]||(e[4]=o=>n.description=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(ee,{modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=o=>g.value=o),type:"sys_role"},null,8,["modelValue"])])}}};export{re as default};
