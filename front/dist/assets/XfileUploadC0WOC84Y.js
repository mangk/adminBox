import"./XvueVe3_Elhr.js";import{i as e,b as l,f as a}from"./XfileUploadCAalf3sV.js";import{u as t,s as o}from"./Xindex3lybcBch.js";import{E as s,a as i}from"./Xelement-plusCO1bik-q.js";import{e as u,al as r,o as n,c as p,a as d,C as v,Q as m,I as c,M as f,P as g,a4 as y,H as h,L as x,u as j,D as X,O as b}from"./X@vueCM7II4So.js";import"./XpiniaHbUHA5wR.js";import"./X@element-plusCerOoRDG.js";import"./XaxiosBh_nfBBj.js";import"./XmittCNZ6avp8.js";import"./Xvue-routerCYJBVSJE.js";import"./XnprogressCIdgZ774.js";import"./Xcos-js-sdk-v5B2H1ItxU.js";import"./Xvue3-sfc-loaderDa78GGQm.js";import"./Xlodash-esBCrAzI1e.js";import"./X@vueuseDU8TvUvn.js";import"./X@popperjsD3lHDW-0.js";import"./X@ctrlD2oWfImC.js";import"./XdayjsBLCVIqfw.js";import"./Xasync-validatorCuo4gI4y.js";import"./Xmemoize-oneDs0C_khL.js";import"./Xnormalize-wheel-esVn5vHDCm.js";import"./X@floating-uipMauM7H8.js";const w={style:{padding:"0px var(--global-padding)"}},z={key:0},_={style:{display:"flex","flex-flow":"row wrap",padding:"var(--global-padding)"}},k=["onMouseleave","onMouseover","onClick"],C={style:{"font-size":"30px","text-align":"center",margin:"var(--global-padding)","margin-bottom":"0"}},V={style:{"font-size":"12px","line-height":"12px",padding:"3px","text-align":"center"}},O={style:{"font-size":"12px","line-height":"12px",padding:"3px",position:"absolute",left:"0",top:"0","background-color":"#409eff",color:"#fff","border-radius":"0 0 5px 0"}},U={class:"el-upload__text",style:{height:"60px","line-height":"60px","text-align":"center",overflow:"hidden",display:"flex","flex-flow":"row nowrap","justify-content":"center"}},A=d("em",null,"点击上传",-1),M={__name:"fileUpload",props:{modelValue:{type:[String,Array],required:!0,default:""},selected:{type:Function,required:!1,default:()=>{}},multiple:{type:Number,default:1},suffixList:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(M,{emit:P}){const $=u({}),B=u("default"),L=t(),S=M,q=P,D=u(S.modelValue);if(Array.isArray(D.value)){let e=[];for(const l in D.value)if(Object.prototype.hasOwnProperty.call(D.value,l)){const a=D.value[l];a&&e.push(a)}D.value=e}else D.value?D.value=[D.value]:D.value=[];const F=()=>{let e=[];for(const l in D.value)if(Object.prototype.hasOwnProperty.call(D.value,l)){const a=D.value[l];e.push(a)}1==S.multiple&&(e=e[0]),q("update:modelValue",e),S.selected&&S.selected(e),T.value=!1},T=u(!1),E=e=>{for(const l in D.value)if(Object.prototype.hasOwnProperty.call(D.value,l)){const a=D.value[l];if(a&&a==e.url)return"img-item-select"}},H=(e,l,a)=>{G()},I=u([]),J=u(1),N=u(25),Q=u(0),G=()=>{l(J.value,N.value,{tag:S.suffixList}).then((e=>{I.value=e.data.list,J.value=e.data.page,N.value=e.data.page_size,Q.value=e.data.total}))},K=e=>{N.value=e,G()},R=e=>{J.value=e,G()},W=u(0),Y=()=>{a().then((e=>{$.value=e.data})),G(),T.value=!0},Z=()=>{T.value=!1};return(l,a)=>{const t=r("UploadFilled"),u=r("el-icon"),M=r("el-button"),P=r("el-radio-button"),q=r("el-radio-group"),ee=r("CircleClose"),le=r("Document"),ae=r("el-image"),te=r("el-pagination"),oe=r("upload-filled"),se=r("el-upload"),ie=r("el-drawer");return n(),p(g,null,[d("div",{class:"upload-file-slot",onClick:Y},[v(l.$slots,"default",{},(()=>[m(M,{type:"primary"},{default:c((()=>[m(u,null,{default:c((()=>[m(t)])),_:1}),f(" 文件上传 ")])),_:1})]))]),m(ie,{modelValue:T.value,"onUpdate:modelValue":a[3]||(a[3]=e=>T.value=e),direction:"rtl","before-close":Z,"show-close":!0,"append-to-body":"",size:"50%",style:{"max-width":"600px"}},{header:c((()=>[d("div",w,[m(M,{type:"primary",onClick:F},{default:c((()=>[f("确定")])),_:1}),Object.keys($.value).length>1?(n(),p("div",z,[m(q,{modelValue:B.value,"onUpdate:modelValue":a[0]||(a[0]=e=>B.value=e),size:"small"},{default:c((()=>[(n(!0),p(g,null,y($.value,((e,l)=>(n(),h(P,{label:e.name,value:e.driver,key:e.driver},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])):x("",!0)])])),footer:c((()=>[m(te,{"current-page":J.value,"onUpdate:currentPage":a[1]||(a[1]=e=>J.value=e),"page-size":N.value,"onUpdate:pageSize":a[2]||(a[2]=e=>N.value=e),"page-sizes":[20,50,100,200],size:"small",layout:"total, prev, pager, next",total:Q.value,onSizeChange:K,onCurrentChange:R},null,8,["current-page","page-size","total"]),m(se,{drag:"",action:`${j(o)()}sys/fileUpload/upload?driver=${B.value}`,headers:{Authorization:"Bearer "+j(L).userAuth().token},"show-file-list":!1,multiple:"","on-success":H},{default:c((()=>[d("div",U,[m(u,{class:"el-icon--upload",style:{"font-size":"35px",margin:"10px var(--global-padding) 0 0"}},{default:c((()=>[m(oe)])),_:1}),f(" 将文件拖到此处或"),A])])),_:1},8,["action","headers"])])),default:c((()=>[d("div",_,[(n(!0),p(g,null,y(I.value,((l,a)=>(n(),p("div",{class:X(["img-item",E(l)]),onMouseleave:e=>(l.id,void(W.value=0)),onMouseover:e=>{return a=l.id,void(W.value=a);var a},onClick:e=>(e=>{let l=!1;for(let a=0;a<D.value.length;a++){const t=D.value[a];t&&t==e.url&&(D.value.splice(a,1),l=!0)}D.value.length>=S.multiple?s({type:"warning",message:`最多选择 ${S.multiple} 个`}):l||D.value.push(e.url)})(l)},[W.value==l.id?(n(),h(u,{key:0,class:"img-del",onClick:a=>(l=>{i.confirm("删除文件?","删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e(l.id).then((e=>{G();for(let a=0;a<D.value.length;a++)D.value[a]==l.url&&D.value.splice(a,1)}))}))})(l)},{default:c((()=>[m(ee)])),_:2},1032,["onClick"])):x("",!0),m(ae,{style:{width:"100%"},src:l.url,fit:"scale-down",lazy:""},{error:c((()=>[d("div",C,[m(u,{style:{"font-size":"28px"}},{default:c((()=>[m(le)])),_:1})]),d("div",V,b(l.name.split(".")[0]),1),d("div",O,b(l.name.split(".")[1]),1)])),_:2},1032,["src"])],42,k)))),256))])])),_:1},8,["modelValue"])],64)}}};export{M as default};
