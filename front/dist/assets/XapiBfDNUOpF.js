import"./XvueBaz_cZdj.js";import{h as e}from"./XindexC9xXd3Oz.js";import{m as a}from"./XmenuBx33FT-3.js";import{b as l,$ as t,j as o,ah as i,o as d,c as r,X as s,Q as u,V as p,P as m,W as n,U as h,a as c,i as g}from"./X@vuen9TiMG2O.js";import"./XpiniaYeQOi8UL.js";import"./Xelement-plusCLM398fa.js";import"./Xlodash-esBg5u8xPa.js";import"./X@vueuseCCX6pF6_.js";import"./X@element-plusBnJF7_W-.js";import"./X@popperjsD3lHDW-0.js";import"./X@ctrlD2oWfImC.js";import"./Xdayjst441MSVg.js";import"./Xasync-validatorCuo4gI4y.js";import"./Xmemoize-oneDs0C_khL.js";import"./Xnormalize-wheel-esVn5vHDCm.js";import"./X@floating-uipMauM7H8.js";import"./XaxiosByKc3Ecy.js";import"./XmittCNZ6avp8.js";import"./Xvue-routerzsXVQF6n.js";import"./XnprogressDgs0sPf-.js";import"./Xvue3-sfc-loaderDa78GGQm.js";const f={class:"main-content"},v={class:"dialog-footer"},_={__name:"api",setup(_){const{proxy:y}=g(),b=l([]),w=l(1),j=l(20),P=l(0),X=l(!1),V=l(),T=t({id:0,menu_id:0,name:"",description:"",path:"",method:""}),k=t({name:[{required:!0,message:"API名称 不能为空",trigger:"blur"}],path:[{required:!0,message:"API地址 不能为空",trigger:"blur"}],method:[{required:!0,message:"API方法 不能为空",trigger:"blur"}]}),E=()=>{((a=1,l=20,t={})=>e({url:"/sys/setting/api/page",method:"POST",data:{page:a,page_size:l,query:t}}))(w.value,j.value).then((e=>{b.value=e.data.list,w.value=e.data.page,j.value=e.data.page_size,P.value=e.data.total}))},I=e=>{j.value=e,E()},z=e=>{w.value=e,E()},C=(a=!1)=>{a?(T.id=a,(a=>e({url:"/sys/setting/api/getById",method:"POST",data:{id:a}}))(a).then((e=>{0===e.code&&(T.id=e.data.id,T.menu_id=e.data.menu_id,T.name=e.data.name,T.description=e.data.description,T.path=e.data.path,T.method=e.data.method)}))):T.id=0,O(),X.value=!0},U=a=>{a?(a=>e({url:"/sys/setting/api",method:"DELETE",data:{id:a}}))(a).then((e=>{0===e.code&&(y.$message.success(e.msg),E())})):y.$message.error("请选择数据ID")},A=async a=>{a&&await a.validate(((l,t)=>{if(l){let l={};l=T.id?e({url:"/sys/setting/api",method:"PUT",data:T}):(a=>e({url:"/sys/setting/api",method:"POST",data:a}))(T),l.then((e=>{0===e.code&&(y.$message.success(e.msg),E(),X.value=!1,x(a))}))}else;}))},S=e=>{X.value=!1,x(e)},x=e=>{e&&e.resetFields()},D=l(),O=async()=>{a(!0).then((e=>{D.value=e.data,q(D.value)}))},q=(e,a)=>{e&&e.forEach((e=>{e.children&&e.children.length?(e.title=e.meta.title,q(e.children,e.disabled)):e.title=e.meta.title}))};return o((()=>{E()})),(e,a)=>{const l=i("Plus"),t=i("el-icon"),o=i("el-button"),g=i("el-form-item"),_=i("el-table-column"),y=i("el-tag"),E=i("Edit"),O=i("Delete"),q=i("el-popconfirm"),L=i("el-table"),$=i("el-cascader"),G=i("el-input"),B=i("el-option"),F=i("el-select"),Q=i("el-form"),R=i("el-dialog"),W=i("el-pagination");return d(),r("div",f,[s(g,{label:""},{default:u((()=>[s(o,{type:"primary",onClick:a[0]||(a[0]=e=>C())},{default:u((()=>[s(t,null,{default:u((()=>[s(l)])),_:1}),p(" 新建API ")])),_:1})])),_:1}),s(L,{data:b.value,"row-key":"id",height:"var(--global-table)",border:"","highlight-current-row":"","show-overflow-tooltip":""},{default:u((()=>[s(_,{prop:"id",label:"ID",sortable:"",fixed:"",width:"80"}),s(_,{prop:"name",label:"api名称"}),s(_,{prop:"description",label:"api描述",width:"160"}),s(_,{prop:"path",label:"api路径",width:"260"}),s(_,{label:"方法"},{default:u((e=>["GET"===e.row.method?(d(),m(y,{key:0,type:"info"},{default:u((()=>[p(n(e.row.method),1)])),_:2},1024)):h("",!0),"POST"===e.row.method?(d(),m(y,{key:1,type:"success"},{default:u((()=>[p(n(e.row.method),1)])),_:2},1024)):h("",!0),"PUT"===e.row.method?(d(),m(y,{key:2,type:"warning"},{default:u((()=>[p(n(e.row.method),1)])),_:2},1024)):h("",!0),"DELETE"===e.row.method?(d(),m(y,{key:3,type:"danger"},{default:u((()=>[p(n(e.row.method),1)])),_:2},1024)):h("",!0)])),_:1}),s(_,{prop:"menu_name",label:"所属菜单",width:"120"}),s(_,{fixed:"right",label:"操作",width:"125"},{default:u((e=>[s(o,{link:"",type:"primary",size:"small",onClick:a=>C(e.row.id)},{default:u((()=>[s(t,null,{default:u((()=>[s(E)])),_:1}),p(" 编辑 ")])),_:2},1032,["onClick"]),e.row.children?h("",!0):(d(),m(q,{key:0,title:"删除后不可恢复，确定删除API【"+e.row.name+"】?",onConfirm:a=>U(e.row.id),width:"200"},{reference:u((()=>[s(o,{link:"",type:"primary",size:"small"},{default:u((()=>[s(t,null,{default:u((()=>[s(O)])),_:1}),p(" 删除 ")])),_:1})])),_:2},1032,["title","onConfirm"]))])),_:1})])),_:1},8,["data"]),s(R,{modelValue:X.value,"onUpdate:modelValue":a[9]||(a[9]=e=>X.value=e),title:T.id?"编辑API":"新建API",width:"80vw","append-to-body":"",onClose:a[10]||(a[10]=e=>S(V.value))},{footer:u((()=>[c("div",v,[s(o,{onClick:a[6]||(a[6]=e=>x(V.value))},{default:u((()=>[p("重置")])),_:1}),s(o,{onClick:a[7]||(a[7]=e=>S(V.value))},{default:u((()=>[p("取消")])),_:1}),s(o,{type:"primary",onClick:a[8]||(a[8]=e=>A(V.value))},{default:u((()=>[p("保存")])),_:1})])])),default:u((()=>[s(Q,{ref_key:"formRef",ref:V,model:T,rules:k,"status-icon":"","label-position":"top","show-all-levels":!1},{default:u((()=>[s(g,{label:"父级菜单",prop:"menuId"},{default:u((()=>[s($,{modelValue:T.menu_id,"onUpdate:modelValue":a[1]||(a[1]=e=>T.menu_id=e),options:D.value,props:{expandTrigger:"hover",checkStrictly:!0,value:"id",label:"title",emitPath:!1},style:{width:"100%"}},null,8,["modelValue","options"])])),_:1}),s(g,{label:"API名称",prop:"name"},{default:u((()=>[s(G,{modelValue:T.name,"onUpdate:modelValue":a[2]||(a[2]=e=>T.name=e)},null,8,["modelValue"])])),_:1}),s(g,{label:"API描述",prop:"description"},{default:u((()=>[s(G,{modelValue:T.description,"onUpdate:modelValue":a[3]||(a[3]=e=>T.description=e)},null,8,["modelValue"])])),_:1}),s(g,{label:"API地址",prop:"path"},{default:u((()=>[s(G,{modelValue:T.path,"onUpdate:modelValue":a[4]||(a[4]=e=>T.path=e)},null,8,["modelValue"])])),_:1}),s(g,{label:"API方法",prop:"method"},{default:u((()=>[s(F,{modelValue:T.method,"onUpdate:modelValue":a[5]||(a[5]=e=>T.method=e)},{default:u((()=>[s(B,{label:"GET",value:"GET"}),s(B,{label:"POST",value:"POST"}),s(B,{label:"PUT",value:"PUT"}),s(B,{label:"DELETE",value:"DELETE"})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),s(W,{"current-page":w.value,"onUpdate:currentPage":a[11]||(a[11]=e=>w.value=e),"page-size":j.value,"onUpdate:pageSize":a[12]||(a[12]=e=>j.value=e),"page-sizes":[20,50,100,200],size:"small",layout:"total, sizes, prev, pager, next, jumper",total:P.value,onSizeChange:I,onCurrentChange:z},null,8,["current-page","page-size","total"])])}}};export{_ as default};
