import"./XvueCyDLjQZ5.js";import{Q as e}from"./X@element-plusCAKmCgXq.js";import{d as l,a,b as i,c as t,e as o}from"./XdepartmentDip7FxIp.js";import r from"./XpremissionSetDNkorjGi.js";import{_ as d}from"./X_plugin-vue_export-helperBCo6x5W8.js";import{r as s,$ as n,j as m,ah as p,o as u,c,X as f,Q as h,V as v,P as _,U as j,a as b,i as y}from"./X@vueSdcp2x8a.js";import"./XindexCSceT_RU.js";import"./XpiniaDkaaaSbL.js";import"./Xelement-plusJnkMASPo.js";import"./Xlodash-esBg5u8xPa.js";import"./X@vueuseCSz_Rkca.js";import"./X@popperjsD3lHDW-0.js";import"./X@ctrlD2oWfImC.js";import"./Xdayjst441MSVg.js";import"./Xasync-validatorCuo4gI4y.js";import"./Xmemoize-oneDs0C_khL.js";import"./Xnormalize-wheel-esVn5vHDCm.js";import"./X@floating-uipMauM7H8.js";import"./Xvue3-sfc-loaderDa78GGQm.js";import"./XaxiosCURSphCx.js";import"./XmittCNZ6avp8.js";import"./Xvue-routerCZMibURm.js";import"./XnprogressDgs0sPf-.js";const X={class:"main-content"},g={class:"dialog-footer"},w=d({__name:"department",setup(d){const{proxy:w}=y(),k=s(0),V=s(!1),C=s([]),x=n([]);for(const[l]of Object.entries(e))x.push({key:l.__name,label:l.__name});const z=s(),U=n({id:0,pid:"",name:"",description:""}),E=n({pid:[{required:!0,trigger:"blur",validator:(e,l,a)=>{""!==l?l!==U.id?a():a(new Error("所选部门不能为当前编辑部门")):a(new Error("父级部门 不能为空"))}}],name:[{required:!0,message:"路由名称 不能为空",trigger:"blur"}]}),$=e=>{V.value=!1,D(e)},D=e=>{e&&e.resetFields()},F=(e=!1)=>{e?(U.id=e,i(e).then((e=>{0===e.code&&(U.pid=e.data.pid,U.name=e.data.name,U.description=e.data.description)}))):U.id=0,q(),V.value=!0},I=()=>{o().then((e=>{C.value=e.data}))},P=s([{id:0,name:"根目录"}]),q=()=>{P.value=[{id:0,name:"根目录"}],Q(C.value,P.value,!1)},Q=(e,l,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const i={name:e.name,id:e.id,disabled:a||e.id===U.id,children:[]};Q(e.children,i.children,a||e.id===U.id),l.push(i)}else{const i={name:e.name,id:e.id,disabled:a||e.id===U.id};l.push(i)}}))};return m((()=>{I()})),(e,i)=>{const o=p("Plus"),d=p("el-icon"),s=p("el-button"),n=p("el-form-item"),m=p("el-table-column"),y=p("Edit"),x=p("Filter"),q=p("Delete"),Q=p("el-popconfirm"),S=p("el-table"),H=p("el-cascader"),O=p("el-input"),R=p("el-form"),T=p("el-dialog");return u(),c("div",X,[f(n,{label:""},{default:h((()=>[f(s,{type:"primary",onClick:i[0]||(i[0]=e=>F())},{default:h((()=>[f(d,null,{default:h((()=>[f(o)])),_:1}),v(" 新建部门 ")])),_:1})])),_:1}),f(S,{data:C.value,"row-key":"id",height:"var(--global-table)",border:"","highlight-current-row":"","show-overflow-tooltip":"","default-expand-all":""},{default:h((()=>[f(m,{prop:"id",label:"ID",sortable:"",fixed:""}),f(m,{prop:"name",label:"部门名称"}),f(m,{prop:"description",label:"部门简介"}),f(m,{fixed:"right",label:"操作",width:"200"},{default:h((e=>[f(s,{link:"",type:"primary",size:"small",onClick:l=>F(e.row.id)},{default:h((()=>[f(d,null,{default:h((()=>[f(y)])),_:1}),v(" 编辑 ")])),_:2},1032,["onClick"]),f(s,{link:"",type:"primary",size:"small",onClick:l=>k.value=e.row.id},{default:h((()=>[f(d,null,{default:h((()=>[f(x)])),_:1}),v(" 权限设置 ")])),_:2},1032,["onClick"]),e.row.children?j("",!0):(u(),_(Q,{key:0,title:"删除后不可恢复，确定删除菜单【"+e.row.name+"】?",onConfirm:l=>{var a;(a=e.row.id)?t(a).then((e=>{0===e.code&&(w.$message.success(e.msg),I())})):w.$message.error("请选择数据ID")},width:"200"},{reference:h((()=>[f(s,{link:"",type:"primary",size:"small"},{default:h((()=>[f(d,null,{default:h((()=>[f(q)])),_:1}),v(" 删除 ")])),_:1})])),_:2},1032,["title","onConfirm"]))])),_:1})])),_:1},8,["data"]),f(T,{modelValue:V.value,"onUpdate:modelValue":i[7]||(i[7]=e=>V.value=e),title:U.id?"编辑部门":"新建部门",width:"800",onClose:i[8]||(i[8]=e=>$(z.value))},{footer:h((()=>[b("div",g,[f(s,{onClick:i[4]||(i[4]=e=>D(z.value))},{default:h((()=>[v("重置")])),_:1}),f(s,{onClick:i[5]||(i[5]=e=>$(z.value))},{default:h((()=>[v("取消")])),_:1}),f(s,{type:"primary",onClick:i[6]||(i[6]=e=>(async e=>{e&&await e.validate(((i,t)=>{if(i){let i={};i=U.id?l(U):a(U),i.then((l=>{0===l.code&&(w.$message.success(l.msg),I(),V.value=!1,D(e))}))}}))})(z.value))},{default:h((()=>[v("保存")])),_:1})])])),default:h((()=>[f(R,{ref_key:"formRef",ref:z,model:U,rules:E,"status-icon":"","label-position":"top","show-all-levels":!1,inline:""},{default:h((()=>[f(n,{label:"父级部门",prop:"pid",style:{width:"40%"}},{default:h((()=>[f(H,{modelValue:U.pid,"onUpdate:modelValue":i[1]||(i[1]=e=>U.pid=e),options:P.value,props:{expandTrigger:"hover",checkStrictly:!0,value:"id",label:"name",emitPath:!1},style:{width:"100%"}},null,8,["modelValue","options"])])),_:1}),f(n,{label:"部门名称",prop:"name",style:{width:"40%"}},{default:h((()=>[f(O,{modelValue:U.name,"onUpdate:modelValue":i[2]||(i[2]=e=>U.name=e)},null,8,["modelValue"])])),_:1}),f(n,{label:"部门简介",prop:"description",style:{width:"40%"}},{default:h((()=>[f(O,{modelValue:U.description,"onUpdate:modelValue":i[3]||(i[3]=e=>U.description=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),f(r,{modelValue:k.value,"onUpdate:modelValue":i[9]||(i[9]=e=>k.value=e),type:"sys_department"},null,8,["modelValue"])])}}},[["__scopeId","data-v-9fb5b15e"]]);export{w as default};
