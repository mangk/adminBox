import{K as y,r as p,a as F,o as ee,c as r,d as C,e as T,f as l,w as o,h as _,k as A,l as le,g as te,F as ae,A as oe,j as ne}from"./XindexD6lHd35a.js";import re from"./XpremissionSetCaomzOrd.js";import{e as se}from"./Xdepartmentf4FqVzP_.js";import{e as de}from"./Xrole_fPBkfKc.js";import ie from"./XfileUploaddYaBpQq-.js";import"./X_plugin-vue_export-helperDlAUqK2U.js";const ue=(s=1,c=20,w={})=>y({url:"/sys/setting/user/page",method:"POST",data:{page:s,page_size:c,query:w}}),me=s=>y({url:"/sys/setting/user/getById",method:"POST",data:{id:s}}),pe=s=>y({url:"/sys/setting/user",method:"POST",data:s}),_e=s=>y({url:"/sys/setting/user",method:"PUT",data:s}),ce=s=>y({url:"/sys/setting/user",method:"DELETE",data:{id:s}}),fe={class:"main-content"},ge={class:"dialog-footer"},ke={__name:"user",setup(s){const{proxy:c}=ne(),w=p([]),f=p(1),g=p(20),U=p(0),x=p(0),v=p(!1),b=p(),a=F({id:0,username:"",phone:"",email:"",nick_name:"",avatar:"",department_ids:[],role_ids:[],enable:!0}),N=F({name:[{required:!0,message:"API名称 不能为空",trigger:"blur"}],path:[{required:!0,message:"API地址 不能为空",trigger:"blur"}],method:[{required:!0,message:"API方法 不能为空",trigger:"blur"}]}),z=p([]),$=p([]),h=()=>{ue(f.value,g.value).then(n=>{w.value=n.data.list,f.value=n.data.page,g.value=n.data.page_size,U.value=n.data.total})},q=n=>{g.value=n,h()},B=n=>{f.value=n,h()},D=(n=!1)=>{se().then(e=>{z.value=e.data}),de().then(e=>{$.value=e.data}),n?(a.id=n,me(n).then(e=>{e.code===0&&(a.id=e.data.id,a.username=e.data.username,a.phone=e.data.phone,a.email=e.data.email,a.nick_name=e.data.nick_name,a.avatar=e.data.avatar,a.enable=e.data.enable,a.department_ids=e.data.department_ids,a.role_ids=e.data.role_ids)})):a.id=0,v.value=!0},E=n=>{n?ce(n).then(e=>{e.code===0&&(c.$message.success(e.msg),h())}):c.$message.error("请选择数据ID"),console.log("del",n)},O=async n=>{n&&await n.validate((e,V)=>{if(!e)console.log("error submit!",V);else{let i={};a.id?i=_e(a):i=pe(a),i.then(d=>{d.code===0&&(c.$message.success(d.msg),h(),v.value=!1,P(n))})}})},I=n=>{v.value=!1,P(n)},P=n=>{n&&n.resetFields()};return ee(()=>{h()}),(n,e)=>{const V=r("Plus"),i=r("el-icon"),d=r("el-button"),u=r("el-form-item"),m=r("el-table-column"),j=r("Edit"),L=r("Filter"),R=r("Delete"),K=r("el-popconfirm"),M=r("el-table"),G=r("el-pagination"),k=r("el-input"),H=r("el-cascader"),J=r("el-option"),Q=r("el-select"),W=r("el-image"),X=r("el-switch"),Y=r("el-form"),Z=r("el-dialog");return C(),T("div",fe,[l(u,{label:""},{default:o(()=>[l(d,{type:"primary",onClick:e[0]||(e[0]=t=>D())},{default:o(()=>[l(i,null,{default:o(()=>[l(V)]),_:1}),_(" 新增用户 ")]),_:1})]),_:1}),l(M,{data:w.value,"row-key":"id",height:"var(--global-table)","header-cell-class-name":"global-el-table-header",border:"","highlight-current-row":"","show-overflow-tooltip":""},{default:o(()=>[l(m,{prop:"id",label:"ID",sortable:"",fixed:""}),l(m,{prop:"uuid",label:"UUID",width:"300"}),l(m,{prop:"nick_name",label:"昵称",width:"120"}),l(m,{prop:"username",label:"用户名"}),l(m,{prop:"phone",label:"手机号",width:"160"}),l(m,{prop:"email",label:"Email",width:"220"}),l(m,{prop:"avatar",label:"头像",width:"120"}),l(m,{prop:"enable",label:"是否启用",width:"120"}),l(m,{fixed:"right",label:"操作",width:"200"},{default:o(t=>[l(d,{link:"",type:"primary",size:"small",onClick:S=>D(t.row.id)},{default:o(()=>[l(i,null,{default:o(()=>[l(j)]),_:1}),_(" 编辑 ")]),_:2},1032,["onClick"]),l(d,{link:"",type:"primary",size:"small",onClick:S=>x.value=t.row.id},{default:o(()=>[l(i,null,{default:o(()=>[l(L)]),_:1}),_(" 权限设置 ")]),_:2},1032,["onClick"]),t.row.children?le("",!0):(C(),A(K,{key:0,title:"删除后不可恢复，确定删除API【"+t.row.nickName+"("+t.row.userName+")】?",onConfirm:S=>E(t.row.id),width:"200"},{reference:o(()=>[l(d,{link:"",type:"primary",size:"small"},{default:o(()=>[l(i,null,{default:o(()=>[l(R)]),_:1}),_(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"]))]),_:1})]),_:1},8,["data"]),l(G,{"current-page":f.value,"onUpdate:currentPage":e[1]||(e[1]=t=>f.value=t),"page-size":g.value,"onUpdate:pageSize":e[2]||(e[2]=t=>g.value=t),"page-sizes":[20,50,100,200],size:"small",layout:"total, sizes, prev, pager, next, jumper",total:U.value,onSizeChange:q,onCurrentChange:B},null,8,["current-page","page-size","total"]),l(Z,{modelValue:v.value,"onUpdate:modelValue":e[14]||(e[14]=t=>v.value=t),title:a.id?"编辑用户":"新建用户",width:"800",onClose:e[15]||(e[15]=t=>I(b.value))},{footer:o(()=>[te("div",ge,[l(d,{onClick:e[11]||(e[11]=t=>P(b.value))},{default:o(()=>[_("重置")]),_:1}),l(d,{onClick:e[12]||(e[12]=t=>I(b.value))},{default:o(()=>[_("取消")]),_:1}),l(d,{type:"primary",onClick:e[13]||(e[13]=t=>O(b.value))},{default:o(()=>[_("保存")]),_:1})])]),default:o(()=>[l(Y,{ref_key:"formRef",ref:b,model:a,rules:N,"status-icon":"",inline:"","label-position":"top","show-all-levels":!1},{default:o(()=>[l(u,{label:"用户名",prop:"username",style:{width:"40%"}},{default:o(()=>[l(k,{modelValue:a.username,"onUpdate:modelValue":e[3]||(e[3]=t=>a.username=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"手机号",prop:"phone",style:{width:"40%"}},{default:o(()=>[l(k,{modelValue:a.phone,"onUpdate:modelValue":e[4]||(e[4]=t=>a.phone=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"Email",prop:"email",style:{width:"40%"}},{default:o(()=>[l(k,{modelValue:a.email,"onUpdate:modelValue":e[5]||(e[5]=t=>a.email=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"昵称",prop:"nick_name",style:{width:"40%"}},{default:o(()=>[l(k,{modelValue:a.nick_name,"onUpdate:modelValue":e[6]||(e[6]=t=>a.nick_name=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"所属部门",prop:"department_ids",style:{width:"40%"}},{default:o(()=>[l(H,{modelValue:a.department_ids,"onUpdate:modelValue":e[7]||(e[7]=t=>a.department_ids=t),options:z.value,placeholder:"设置用户部门",props:{checkStrictly:!0,expandTrigger:"hover",value:"id",label:"name",multiple:!0,emitPath:!1},style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),l(u,{label:"用户角色",prop:"role_ids",style:{width:"40%"}},{default:o(()=>[l(Q,{modelValue:a.role_ids,"onUpdate:modelValue":e[8]||(e[8]=t=>a.role_ids=t),multiple:"",placeholder:"设置用户角色"},{default:o(()=>[(C(!0),T(ae,null,oe($.value,t=>(C(),A(J,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"头像",prop:"avatar",style:{width:"40%"}},{default:o(()=>[l(W,{style:{width:"75px",height:"75px",border:"1px dashed var(--el-border-color)","border-radius":"5px"},src:a.avatar,fit:"contain"},null,8,["src"]),l(ie,{modelValue:a.avatar,"onUpdate:modelValue":e[9]||(e[9]=t=>a.avatar=t),onlyPath:!0},{default:o(()=>[l(i,{style:{width:"75px",height:"75px",border:"1px dashed var(--el-border-color)","border-radius":"5px","margin-left":"10px"}},{default:o(()=>[l(V)]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"是否启用",prop:"enable",style:{width:"40%"}},{default:o(()=>[l(X,{modelValue:a.enable,"onUpdate:modelValue":e[10]||(e[10]=t=>a.enable=t),"inline-prompt":"","active-icon":"Check","inactive-icon":"Close"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),l(re,{modelValue:x.value,"onUpdate:modelValue":e[16]||(e[16]=t=>x.value=t),type:"sys_user"},null,8,["modelValue"])])}}};export{ke as default};
