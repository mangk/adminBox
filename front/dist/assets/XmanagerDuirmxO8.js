import"./XvueBaz_cZdj.js";import{B as e,R as a,A as l,S as t,o,T as i,U as n,V as s,c as d,M as r}from"./X@element-plusTeXHQB6B.js";import{f as u,a as p,b as c,c as m,d as v,e as f,g,h}from"./XfileUploadBqy2JMHB.js";import"./XindexDJaXbwzH.js";import{u as b}from"./Xqiniu-jsDnNvbc3G.js";import{E as y,a as w}from"./Xelement-plusCBHzP_ll.js";import{b as x,ah as j,o as _,c as X,X as k,Q as z,a as C,K as U,W as V,u as T,V as E,P as S,U as A}from"./X@vuen9TiMG2O.js";import"./XpiniaYeQOi8UL.js";import"./XaxiosDtE8dZ3W.js";import"./XmittCNZ6avp8.js";import"./Xvue-routerzsXVQF6n.js";import"./XnprogressDgs0sPf-.js";import"./Xdayjst441MSVg.js";import"./Xvue3-sfc-loaderDa78GGQm.js";import"./Xlodash-esBg5u8xPa.js";import"./X@vueuseCCX6pF6_.js";import"./X@popperjsD3lHDW-0.js";import"./X@ctrlD2oWfImC.js";import"./Xasync-validatorCuo4gI4y.js";import"./Xmemoize-oneDs0C_khL.js";import"./Xnormalize-wheel-esVn5vHDCm.js";import"./X@floating-uipMauM7H8.js";import"./Xspark-md5LXhfRQWH.js";import"./Xexif-jsCywF333L.js";const B={class:"main-content"},P={style:{position:"absolute",bottom:"5px",left:"10px"}},q={class:"file-list-box"},I={class:"el-upload__text",style:{height:"30px","line-height":"30px","text-align":"center",overflow:"hidden",display:"flex","flex-flow":"row nowrap","justify-content":"center"}},L=C("em",null,"点击选择文件",-1),N={class:"el-upload__tip"},R={__name:"manager",setup(R){const G=x({});u().then((e=>{G.value=e.data}));const K=x([]),M=()=>{p().then((e=>{const a=Array.isArray(e.data)?e.data:[];K.value=a}))};M();const Q=x(""),W=x(!1),D=x();x(0);const F=x([]),H=x(1),J=x(20),O=x(0),Y=x(0),Z=x(""),$=x(""),ee=x([]),ae=x([]),le=(e=!1)=>{e&&(H.value=1,J.value=20);let a={};Y.value&&(a.group_id=Y.value),Z.value&&(a.name=Z.value),$.value&&(a.tag=$.value),c(H.value,J.value,a).then((e=>{ee.value=e.data.list,H.value=e.data.page,J.value=e.data.page_size,O.value=e.data.total})),ae.value=[]},te=()=>{Q.value?m(Q.value,Y.value).then((e=>{M(),Q.value=""})):y.warning("请输入分组名称")},oe=()=>{Y.value?v(Y.value).then((e=>{M()})):y.warning("请选择分组")},ie=async e=>{let a=await f(e.file.name);b(e.file,a.data.key,a.data.token).subscribe((a=>{e.onProgress(a.total)}),(a=>{e.onError(a),setTimeout((()=>{Y.value=0,le(!0)}),1500)}),(a=>{e.onSuccess(a),setTimeout((()=>{Y.value=0,le(!0)}),1500)}))},ne=()=>{D.value.submit()},se=(e,a)=>{a.findIndex((a=>a.name==e.name))!=a.findLastIndex((a=>a.name==e.name))&&(y.info(e.name+" 已存在于列表中"),a.pop()),F.value=a},de=e=>{ae.value=e.map((e=>e.id))},re=e=>{J.value=e,le()},ue=e=>{H.value=e,le()},pe=e=>{e.id?Y.value=e.id:Y.value="",le(!0)},ce=e=>{g(ae.value,e.id).then((e=>{0!=e.code?y.error(e.msg):y.success("移动成功"),le()}))},me=async e=>{switch(e){case"downlaod":ee.value.forEach((async e=>{if(ae.value.includes(e.id)){const a=document.createElement("iframe");a.style.display="none",a.src=e.url+"?attname=",document.body.appendChild(a),setTimeout((()=>{document.body.removeChild(a)}),5e3)}}));break;case"copyUrl":try{let e="";ee.value.forEach((a=>{ae.value.includes(a.id)&&(e+=a.url+"\n")})),await navigator.clipboard.writeText(e),y({message:"已复制",type:"success"})}catch(a){y({message:"未授权读取剪贴板",type:"error"})}break;case"delete":w.confirm("删除后文件无法找回！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{h(ae.value).then((e=>{0==e.code&&y({message:"已删除",type:"success"}),le()}))}))}};return le(),(u,p)=>{const c=j("el-tree"),m=j("el-button"),v=j("el-input"),f=j("el-popover"),g=j("el-col"),h=j("upload-filled"),b=j("el-icon"),y=j("el-upload"),w=j("el-dropdown-item"),x=j("el-dropdown-menu"),R=j("el-dropdown"),G=j("el-row"),M=j("el-table-column"),$=j("el-table"),ve=j("el-pagination");return _(),X("div",B,[k(G,{gutter:10},{default:z((()=>[k(g,{span:4,style:{position:"relative"}},{default:z((()=>[k(c,{class:"file-tree-box",data:K.value,props:{label:"name",children:"children"},onNodeClick:pe,"default-expand-all":"","expand-on-click-node":!1,draggable:""},{default:z((({node:e,data:a})=>[C("div",{class:U(a.id==Y.value?"self-node node-active":"self-node")},V(e.label),3)])),_:1},8,["data"]),C("div",P,[k(f,{placement:"top-start",width:260,trigger:"hover"},{reference:z((()=>[k(m,{icon:T(e),size:"small",style:{"border-right":"0px"},link:""},null,8,["icon"])])),default:z((()=>[k(v,{modelValue:Q.value,"onUpdate:modelValue":p[0]||(p[0]=e=>Q.value=e),style:{width:"200px"},size:"small",placeholder:"输入分组名称"},null,8,["modelValue"]),k(m,{icon:T(a),type:"success",style:{"margin-left":"10px"},onClick:te,link:""},null,8,["icon"])])),_:1}),k(m,{icon:T(l),size:"small",onClick:oe,link:""},null,8,["icon"])])])),_:1}),k(g,{span:20},{default:z((()=>[C("div",q,[k(G,{style:{display:"flex","justify-content":"space-between"}},{default:z((()=>[C("div",null,[k(f,{placement:"bottom-start",width:400,visible:W.value},{reference:z((()=>[k(m,{type:"primary",icon:T(t),onClick:p[1]||(p[1]=e=>W.value=!W.value)},{default:z((()=>[E(" 上传文件 ")])),_:1},8,["icon"])])),default:z((()=>[k(y,{class:"upload-demo",drag:"","auto-upload":!1,ref_key:"fileUploadRef",ref:D,"http-request":ie,"file-list":F.value,"onUpdate:fileList":p[2]||(p[2]=e=>F.value=e),"on-change":se,multiple:""},{trigger:z((()=>[C("div",I,[k(b,{class:"el-icon--upload",style:{"font-size":"25px",margin:"0px var(--global-padding) 0 0"}},{default:z((()=>[k(h)])),_:1}),E(" 将文件拖到此处或"),L])])),tip:z((()=>[C("div",N,[F.value.length?(_(),S(m,{key:0,type:"success",size:"small",icon:T(o),onClick:ne},{default:z((()=>[E(" 开始上传 ")])),_:1},8,["icon"])):A("",!0)])])),_:1},8,["file-list"])])),_:1},8,["visible"]),k(R,{disabled:!ae.value.length,style:{"margin-left":"10px"},onCommand:me},{dropdown:z((()=>[k(x,null,{default:z((()=>[k(w,{command:"downlaod",icon:T(i)},{default:z((()=>[E("下载文件")])),_:1},8,["icon"]),k(w,{command:"copyUrl",icon:T(n)},{default:z((()=>[E("复制链接")])),_:1},8,["icon"]),k(w,{command:"move",icon:T(s)},{default:z((()=>[k(f,{placement:"right",width:300,trigger:"hover"},{reference:z((()=>[E(" 移动到 ")])),default:z((()=>[k(c,{data:K.value,props:{label:"name",children:"children"},onNodeClick:ce,"default-expand-all":"","expand-on-click-node":!1,draggable:""},{default:z((({node:e,data:a})=>[E(V(e.label),1)])),_:1},8,["data"])])),_:1})])),_:1},8,["icon"]),k(w,{command:"delete",icon:T(d),divided:""},{default:z((()=>[E("删除")])),_:1},8,["icon"])])),_:1})])),default:z((()=>[k(m,{disabled:!ae.value.length},{default:z((()=>[E(" 批量操作 ")])),_:1},8,["disabled"])])),_:1},8,["disabled"])]),k(v,{modelValue:Z.value,"onUpdate:modelValue":p[4]||(p[4]=e=>Z.value=e),style:{"max-width":"450px"},placeholder:"搜索文件名",clearable:"",class:"input-with-select",onClear:p[5]||(p[5]=e=>le(!0))},{append:z((()=>[k(m,{icon:T(r),onClick:p[3]||(p[3]=e=>le(!0))},null,8,["icon"])])),_:1},8,["modelValue"])])),_:1}),k($,{data:ee.value,"row-key":"id","highlight-current-row":"","show-overflow-tooltip":"",stripe:"",style:{width:"100%","margin-top":"9px","border-top":"1px solid var(--el-table-border-color)",height:"var(--global-table)"},onSelectionChange:de},{default:z((()=>[k(M,{type:"selection",width:"55",fixed:""}),k(M,{prop:"name",label:"文件名",width:"400"}),k(M,{prop:"url",label:"链接",width:"80"}),k(M,{prop:"tag",label:"类型",width:"80"}),k(M,{prop:"group_info.name",label:"分组"}),k(M,{prop:"ct",label:"创建时间",width:"160"})])),_:1},8,["data"]),k(ve,{"current-page":H.value,"onUpdate:currentPage":p[6]||(p[6]=e=>H.value=e),"page-size":J.value,"onUpdate:pageSize":p[7]||(p[7]=e=>J.value=e),"page-sizes":[20,50,100,200],size:"small",layout:"total, sizes, prev, pager, next, jumper",total:O.value,onSizeChange:re,onCurrentChange:ue},null,8,["current-page","page-size","total"])])])),_:1})])),_:1})])}}};export{R as default};
