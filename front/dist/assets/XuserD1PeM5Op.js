import"./XvueVe3_Elhr.js";import{h as e}from"./Xindex3lybcBch.js";import l from"./XpremissionSetDyALD3TM.js";import{e as a}from"./Xdepartmentnta1LWq_.js";import{e as t}from"./XroleBPTq8ApM.js";import o from"./XfileUploadC0WOC84Y.js";import{e as d,k as r,m as i,al as u,o as s,c as n,Q as p,I as m,P as c,a4 as h,H as f,M as _,L as v,O as b,a as y,l as g}from"./X@vueCM7II4So.js";import"./XpiniaHbUHA5wR.js";import"./Xelement-plusCO1bik-q.js";import"./Xlodash-esBCrAzI1e.js";import"./X@vueuseDU8TvUvn.js";import"./X@element-plusCerOoRDG.js";import"./X@popperjsD3lHDW-0.js";import"./X@ctrlD2oWfImC.js";import"./XdayjsBLCVIqfw.js";import"./Xcos-js-sdk-v5B2H1ItxU.js";import"./Xasync-validatorCuo4gI4y.js";import"./Xmemoize-oneDs0C_khL.js";import"./Xnormalize-wheel-esVn5vHDCm.js";import"./X@floating-uipMauM7H8.js";import"./XaxiosBh_nfBBj.js";import"./XmittCNZ6avp8.js";import"./Xvue-routerCYJBVSJE.js";import"./XnprogressCIdgZ774.js";import"./Xvue3-sfc-loaderDa78GGQm.js";import"./X_plugin-vue_export-helperBCo6x5W8.js";import"./XfileUploadCAalf3sV.js";const w={class:"main-content",style:{"background-color":"#fff"}},V={class:"dialog-footer"},k={__name:"user",setup(k){const{proxy:j}=g(),X=d([]),x=d(1),U=d(20),C=d(0),z=d(0),P=d(!1),I=d(),S=r({id:0,username:"",phone:"",email:"",nick_name:"",password:"",avatar:"",department_ids:[],role_ids:[],enable:!0}),E=r({name:[{required:!0,message:"API名称 不能为空",trigger:"blur"}],path:[{required:!0,message:"API地址 不能为空",trigger:"blur"}],method:[{required:!0,message:"API方法 不能为空",trigger:"blur"}]}),T=d([]),q=d([]),D=()=>{((l=1,a=20,t={})=>e({url:"/sys/setting/user/page",method:"POST",data:{page:l,page_size:a,query:t}}))(x.value,U.value,H).then((e=>{X.value=e.data.list,x.value=e.data.page,U.value=e.data.page_size,C.value=e.data.total}))},F=e=>{U.value=e,D()},O=e=>{x.value=e,D()},A=(l=!1)=>{l?(S.id=l,(l=>e({url:"/sys/setting/user/getById",method:"POST",data:{id:l}}))(l).then((e=>{0===e.code&&(S.id=e.data.id,S.username=e.data.username,S.phone=e.data.phone,S.email=e.data.email,S.nick_name=e.data.nick_name,S.avatar=e.data.avatar,S.enable=e.data.enable,S.department_ids=e.data.department_ids,S.role_ids=e.data.role_ids)}))):S.id=0,P.value=!0},L=l=>{l?(l=>e({url:"/sys/setting/user",method:"DELETE",data:{id:l}}))(l).then((e=>{0===e.code&&(j.$message.success(e.msg),D())})):j.$message.error("请选择数据ID")},$=async l=>{l&&await l.validate(((a,t)=>{if(a){let a={};a=S.id?e({url:"/sys/setting/user",method:"PUT",data:S}):(l=>e({url:"/sys/setting/user",method:"POST",data:l}))(S),a.then((e=>{0===e.code&&(j.$message.success(e.msg),D(),P.value=!1,B(l))}))}else;}))},M=e=>{P.value=!1,B(e)},B=e=>{e&&e.resetFields()},H=r({keyword:"",enable:"",role:"",department:""});return i((()=>{D(),t().then((e=>{q.value=e.data})),a().then((e=>{T.value=e.data}))})),(e,a)=>{const t=u("el-input"),d=u("el-form-item"),r=u("el-option"),i=u("el-select"),g=u("Search"),k=u("el-icon"),j=u("el-button"),J=u("Plus"),Q=u("el-form"),R=u("el-table-column"),G=u("el-avatar"),K=u("el-tag"),N=u("Edit"),W=u("Filter"),Y=u("Delete"),Z=u("el-popconfirm"),ee=u("el-table"),le=u("el-pagination"),ae=u("el-cascader"),te=u("el-image"),oe=u("el-switch"),de=u("el-dialog");return s(),n("div",w,[p(Q,{inline:!0},{default:m((()=>[p(d,null,{default:m((()=>[p(t,{modelValue:H.keyword,"onUpdate:modelValue":a[0]||(a[0]=e=>H.keyword=e),placeholder:"昵称/用户名/手机号/Email",clearable:"",style:{width:"190px"}},null,8,["modelValue"])])),_:1}),p(d,null,{default:m((()=>[p(i,{modelValue:H.enable,"onUpdate:modelValue":a[1]||(a[1]=e=>H.enable=e),placeholder:"是否启用",clearable:"",style:{width:"120px"}},{default:m((()=>[p(r,{key:"1",label:"是",value:"1"}),p(r,{key:"2",label:"否",value:"0"})])),_:1},8,["modelValue"])])),_:1}),p(d,null,{default:m((()=>[p(i,{modelValue:H.role,"onUpdate:modelValue":a[2]||(a[2]=e=>H.role=e),placeholder:"授权角色",clearable:"",style:{width:"120px"}},{default:m((()=>[(s(!0),n(c,null,h(q.value,(e=>(s(),f(r,{key:e.id,label:e.name,value:e.id+""},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(d,null,{default:m((()=>[p(i,{modelValue:H.department,"onUpdate:modelValue":a[3]||(a[3]=e=>H.department=e),placeholder:"所属部门",clearable:"",style:{width:"120px"}},{default:m((()=>[(s(!0),n(c,null,h(T.value,(e=>(s(),f(r,{key:e.id,label:e.name,value:e.id+""},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(d,null,{default:m((()=>[p(j,{type:"primary",onClick:D},{default:m((()=>[p(k,null,{default:m((()=>[p(g)])),_:1}),_(" 查找 ")])),_:1})])),_:1}),p(d,{style:{float:"right","margin-right":"0px"}},{default:m((()=>[p(j,{type:"primary",onClick:a[4]||(a[4]=e=>A())},{default:m((()=>[p(k,null,{default:m((()=>[p(J)])),_:1}),_(" 新增用户 ")])),_:1})])),_:1})])),_:1}),p(ee,{data:X.value,"row-key":"id",height:"var(--global-table)",border:"","highlight-current-row":"","show-overflow-tooltip":""},{default:m((()=>[p(R,{prop:"id",label:"ID",width:"80",sortable:"",fixed:""}),p(R,{prop:"avatar",label:"头像",width:"60"},{default:m((e=>[p(G,{src:e.row.avatar,icon:"UserFilled",size:30},null,8,["src"])])),_:1}),p(R,{prop:"nick_name",label:"昵称",width:"120"}),p(R,{prop:"username",label:"用户名"}),p(R,{prop:"phone",label:"手机号",width:"160"}),p(R,{prop:"email",label:"Email",width:"220"}),p(R,{prop:"enable",label:"是否启用"},{default:m((e=>[e.row.enable?(s(),f(K,{key:0,type:"success"},{default:m((()=>[_("启用")])),_:1})):v("",!0),e.row.enable?v("",!0):(s(),f(K,{key:1,type:"error"},{default:m((()=>[_("禁用")])),_:1}))])),_:1}),p(R,{prop:"role_list",label:"角色","min-width":"60"},{default:m((e=>[(s(!0),n(c,null,h(e.row.role_list,(e=>(s(),n(c,null,[_(b(e.name)+"、",1)],64)))),256))])),_:1}),p(R,{prop:"department_list",label:"部门","min-width":"60"},{default:m((e=>[(s(!0),n(c,null,h(e.row.department_list,(e=>(s(),n(c,null,[_(b(e.name)+"、",1)],64)))),256))])),_:1}),p(R,{fixed:"right",label:"操作",width:"200"},{default:m((e=>[p(j,{link:"",type:"primary",size:"small",onClick:l=>A(e.row.id)},{default:m((()=>[p(k,null,{default:m((()=>[p(N)])),_:1}),_(" 编辑 ")])),_:2},1032,["onClick"]),p(j,{link:"",type:"primary",size:"small",onClick:l=>z.value=e.row.id},{default:m((()=>[p(k,null,{default:m((()=>[p(W)])),_:1}),_(" 权限设置 ")])),_:2},1032,["onClick"]),e.row.children?v("",!0):(s(),f(Z,{key:0,title:"删除后不可恢复，确定删除用户【"+e.row.nick_name+"("+e.row.username+")】?",onConfirm:l=>L(e.row.id),width:"200"},{reference:m((()=>[p(j,{link:"",type:"primary",size:"small"},{default:m((()=>[p(k,null,{default:m((()=>[p(Y)])),_:1}),_(" 删除 ")])),_:1})])),_:2},1032,["title","onConfirm"]))])),_:1})])),_:1},8,["data"]),p(le,{"current-page":x.value,"onUpdate:currentPage":a[5]||(a[5]=e=>x.value=e),"page-size":U.value,"onUpdate:pageSize":a[6]||(a[6]=e=>U.value=e),"page-sizes":[20,50,100,200],size:"small",layout:"total, sizes, prev, pager, next, jumper",total:C.value,onSizeChange:F,onCurrentChange:O},null,8,["current-page","page-size","total"]),p(de,{modelValue:P.value,"onUpdate:modelValue":a[19]||(a[19]=e=>P.value=e),title:S.id?"编辑用户":"新建用户",width:"80vw","append-to-body":"",onClose:a[20]||(a[20]=e=>M(I.value))},{footer:m((()=>[y("div",V,[p(j,{onClick:a[16]||(a[16]=e=>B(I.value))},{default:m((()=>[_("重置")])),_:1}),p(j,{onClick:a[17]||(a[17]=e=>M(I.value))},{default:m((()=>[_("取消")])),_:1}),p(j,{type:"primary",onClick:a[18]||(a[18]=e=>$(I.value))},{default:m((()=>[_("保存")])),_:1})])])),default:m((()=>[p(Q,{ref_key:"formRef",ref:I,model:S,rules:E,"status-icon":"",inline:"","label-position":"top","show-all-levels":!1},{default:m((()=>[p(d,{label:"用户名",prop:"username",style:{width:"40%"}},{default:m((()=>[p(t,{modelValue:S.username,"onUpdate:modelValue":a[7]||(a[7]=e=>S.username=e)},null,8,["modelValue"])])),_:1}),p(d,{label:"昵称",prop:"nick_name",style:{width:"40%"}},{default:m((()=>[p(t,{modelValue:S.nick_name,"onUpdate:modelValue":a[8]||(a[8]=e=>S.nick_name=e)},null,8,["modelValue"])])),_:1}),p(d,{label:"手机号",prop:"phone",style:{width:"40%"}},{default:m((()=>[p(t,{modelValue:S.phone,"onUpdate:modelValue":a[9]||(a[9]=e=>S.phone=e)},null,8,["modelValue"])])),_:1}),p(d,{label:"Email",prop:"email",style:{width:"40%"}},{default:m((()=>[p(t,{modelValue:S.email,"onUpdate:modelValue":a[10]||(a[10]=e=>S.email=e)},null,8,["modelValue"])])),_:1}),p(d,{label:"密码",prop:"password",style:{width:"40%"}},{default:m((()=>[p(t,{modelValue:S.password,"onUpdate:modelValue":a[11]||(a[11]=e=>S.password=e)},null,8,["modelValue"])])),_:1}),p(d,{label:"所属部门",prop:"department_ids",style:{width:"40%"}},{default:m((()=>[p(ae,{modelValue:S.department_ids,"onUpdate:modelValue":a[12]||(a[12]=e=>S.department_ids=e),options:T.value,placeholder:"设置用户部门",props:{checkStrictly:!0,expandTrigger:"hover",value:"id",label:"name",multiple:!0,emitPath:!1},style:{width:"100%"}},null,8,["modelValue","options"])])),_:1}),p(d,{label:"用户角色",prop:"role_ids",style:{width:"40%"}},{default:m((()=>[p(i,{modelValue:S.role_ids,"onUpdate:modelValue":a[13]||(a[13]=e=>S.role_ids=e),multiple:"",placeholder:"设置用户角色"},{default:m((()=>[(s(!0),n(c,null,h(q.value,(e=>(s(),f(r,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(d,{label:"头像",prop:"avatar",style:{width:"40%"}},{default:m((()=>[p(o,{modelValue:S.avatar,"onUpdate:modelValue":a[14]||(a[14]=e=>S.avatar=e)},{default:m((()=>[S.avatar?(s(),f(te,{key:0,style:{width:"75px",height:"75px",border:"1px dashed var(--el-border-color)","border-radius":"5px"},src:S.avatar,fit:"contain"},null,8,["src"])):v("",!0),S.avatar?v("",!0):(s(),f(k,{key:1,style:{width:"75px",height:"75px",border:"1px dashed var(--el-border-color)","border-radius":"5px","margin-left":"10px"}},{default:m((()=>[p(J)])),_:1}))])),_:1},8,["modelValue"])])),_:1}),p(d,{label:"是否启用",prop:"enable",style:{width:"40%"}},{default:m((()=>[p(oe,{modelValue:S.enable,"onUpdate:modelValue":a[15]||(a[15]=e=>S.enable=e),"inline-prompt":"","active-icon":"Check","inactive-icon":"Close"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),p(l,{modelValue:z.value,"onUpdate:modelValue":a[21]||(a[21]=e=>z.value=e),type:"sys_user"},null,8,["modelValue"])])}}};export{k as default};
