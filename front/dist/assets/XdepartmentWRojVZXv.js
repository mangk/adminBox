import"./XvueBaz_cZdj.js";import{Q as e}from"./X@element-plusRXoBkpEf.js";import{d as l,a,b as i,c as t,e as o}from"./XdepartmentBsFVsq8t.js";import d from"./XpremissionSetD7KNznhz.js";import{_ as r}from"./X_plugin-vue_export-helperBCo6x5W8.js";import{b as s,$ as n,j as p,ah as m,o as u,c,X as f,Q as h,V as v,P as _,U as b,a as j,i as y}from"./X@vuen9TiMG2O.js";import"./XindexCgaQ124S.js";import"./XpiniaYeQOi8UL.js";import"./Xelement-plusClartUns.js";import"./Xlodash-esBg5u8xPa.js";import"./X@vueuseCCX6pF6_.js";import"./X@popperjsD3lHDW-0.js";import"./X@ctrlD2oWfImC.js";import"./Xdayjst441MSVg.js";import"./Xasync-validatorCuo4gI4y.js";import"./Xmemoize-oneDs0C_khL.js";import"./Xnormalize-wheel-esVn5vHDCm.js";import"./X@floating-uipMauM7H8.js";import"./XaxiosDtE8dZ3W.js";import"./XmittCNZ6avp8.js";import"./Xvue-routerzsXVQF6n.js";import"./XnprogressDgs0sPf-.js";import"./Xvue3-sfc-loaderDa78GGQm.js";const w={class:"main-content"},X={class:"dialog-footer"},g=r({__name:"department",setup(r){const{proxy:g}=y(),k=s(0),V=s(!1),C=s([]),x=n([]);for(const[l]of Object.entries(e))x.push({key:l.__name,label:l.__name});const z=s(),U=n({id:0,pid:"",name:"",description:""}),E=n({pid:[{required:!0,trigger:"blur",validator:(e,l,a)=>{""!==l?l!==U.id?a():a(new Error("所选部门不能为当前编辑部门")):a(new Error("父级部门 不能为空"))}}],name:[{required:!0,message:"路由名称 不能为空",trigger:"blur"}]}),I=e=>{V.value=!1,$(e)},$=e=>{e&&e.resetFields()},D=(e=!1)=>{e?(U.id=e,i(e).then((e=>{0===e.code&&(U.pid=e.data.pid,U.name=e.data.name,U.description=e.data.description)}))):U.id=0,q(),V.value=!0},F=()=>{o().then((e=>{C.value=e.data}))},P=s([{id:0,name:"根目录"}]),q=()=>{P.value=[{id:0,name:"根目录"}],Q(C.value,P.value,!1)},Q=(e,l,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const i={name:e.name,id:e.id,disabled:a||e.id===U.id,children:[]};Q(e.children,i.children,a||e.id===U.id),l.push(i)}else{const i={name:e.name,id:e.id,disabled:a||e.id===U.id};l.push(i)}}))};return p((()=>{F()})),(e,i)=>{const o=m("Plus"),r=m("el-icon"),s=m("el-button"),n=m("el-form-item"),p=m("el-table-column"),y=m("Edit"),x=m("Filter"),q=m("Delete"),Q=m("el-popconfirm"),S=m("el-table"),O=m("el-cascader"),R=m("el-input"),T=m("el-form"),A=m("el-dialog");return u(),c("div",w,[f(n,{label:""},{default:h((()=>[f(s,{type:"primary",onClick:i[0]||(i[0]=e=>D())},{default:h((()=>[f(r,null,{default:h((()=>[f(o)])),_:1}),v(" 新建部门 ")])),_:1})])),_:1}),f(S,{data:C.value,"row-key":"id",height:"var(--global-table)",border:"","highlight-current-row":"","show-overflow-tooltip":"","default-expand-all":"",width:"80vw","append-to-body":""},{default:h((()=>[f(p,{prop:"id",label:"ID",sortable:"",fixed:""}),f(p,{prop:"name",label:"部门名称"}),f(p,{prop:"description",label:"部门简介"}),f(p,{fixed:"right",label:"操作",width:"200"},{default:h((e=>[f(s,{link:"",type:"primary",size:"small",onClick:l=>D(e.row.id)},{default:h((()=>[f(r,null,{default:h((()=>[f(y)])),_:1}),v(" 编辑 ")])),_:2},1032,["onClick"]),f(s,{link:"",type:"primary",size:"small",onClick:l=>k.value=e.row.id},{default:h((()=>[f(r,null,{default:h((()=>[f(x)])),_:1}),v(" 权限设置 ")])),_:2},1032,["onClick"]),e.row.children?b("",!0):(u(),_(Q,{key:0,title:"删除后不可恢复，确定删除菜单【"+e.row.name+"】?",onConfirm:l=>{var a;(a=e.row.id)?t(a).then((e=>{0===e.code&&(g.$message.success(e.msg),F())})):g.$message.error("请选择数据ID")},width:"200"},{reference:h((()=>[f(s,{link:"",type:"primary",size:"small"},{default:h((()=>[f(r,null,{default:h((()=>[f(q)])),_:1}),v(" 删除 ")])),_:1})])),_:2},1032,["title","onConfirm"]))])),_:1})])),_:1},8,["data"]),f(A,{modelValue:V.value,"onUpdate:modelValue":i[7]||(i[7]=e=>V.value=e),title:U.id?"编辑部门":"新建部门",width:"80vw","append-to-body":"",onClose:i[8]||(i[8]=e=>I(z.value))},{footer:h((()=>[j("div",X,[f(s,{onClick:i[4]||(i[4]=e=>$(z.value))},{default:h((()=>[v("重置")])),_:1}),f(s,{onClick:i[5]||(i[5]=e=>I(z.value))},{default:h((()=>[v("取消")])),_:1}),f(s,{type:"primary",onClick:i[6]||(i[6]=e=>(async e=>{e&&await e.validate(((i,t)=>{if(i){let i={};i=U.id?l(U):a(U),i.then((l=>{0===l.code&&(g.$message.success(l.msg),F(),V.value=!1,$(e))}))}}))})(z.value))},{default:h((()=>[v("保存")])),_:1})])])),default:h((()=>[f(T,{ref_key:"formRef",ref:z,model:U,rules:E,"status-icon":"","label-position":"top","show-all-levels":!1,inline:""},{default:h((()=>[f(n,{label:"父级部门",prop:"pid",style:{width:"40%"}},{default:h((()=>[f(O,{modelValue:U.pid,"onUpdate:modelValue":i[1]||(i[1]=e=>U.pid=e),options:P.value,props:{expandTrigger:"hover",checkStrictly:!0,value:"id",label:"name",emitPath:!1},style:{width:"100%"}},null,8,["modelValue","options"])])),_:1}),f(n,{label:"部门名称",prop:"name",style:{width:"40%"}},{default:h((()=>[f(R,{modelValue:U.name,"onUpdate:modelValue":i[2]||(i[2]=e=>U.name=e)},null,8,["modelValue"])])),_:1}),f(n,{label:"部门简介",prop:"description",style:{width:"40%"}},{default:h((()=>[f(R,{modelValue:U.description,"onUpdate:modelValue":i[3]||(i[3]=e=>U.description=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),f(d,{modelValue:k.value,"onUpdate:modelValue":i[9]||(i[9]=e=>k.value=e),type:"sys_department"},null,8,["modelValue"])])}}},[["__scopeId","data-v-02d6f74c"]]);export{g as default};
