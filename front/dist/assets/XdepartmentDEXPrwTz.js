import{r as c,a as h,L as R,K as T,f as r,o as I,c as K,d as t,w as n,g as u,j as A,k as G,e as H,i as J}from"./XindexBfS_pF-V.js";import{d as Q,a as W,b as X,c as Y,e as Z}from"./XdepartmentDAR4l277.js";import ee from"./XpremissionSetCy8ooeWQ.js";import{_ as te}from"./X_plugin-vue_export-helperDlAUqK2U.js";const le={class:"main-content"},oe={class:"dialog-footer"},ne={__name:"department",setup(ae){const{proxy:v}=J(),g=c(0),m=c(!1),b=c([]),P=h([]);for(const[l]of Object.entries(R))P.push({key:l.__name,label:l.__name});const p=c(),o=h({id:0,pid:"",name:"",description:""}),U=h({pid:[{required:!0,trigger:"blur",validator:(l,e,d)=>{if(console.log(l,e,d),e===""){d(new Error("父级部门 不能为空"));return}if(e===o.id){d(new Error("所选部门不能为当前编辑部门"));return}d()}}],name:[{required:!0,message:"路由名称 不能为空",trigger:"blur"}]}),F=async l=>{l&&await l.validate((e,d)=>{if(!e)console.log("error submit!",d);else{let s={};console.log(o.id),o.id?s=Q(o):s=W(o),s.then(i=>{i.code===0&&(v.$message.success(i.msg),w(),m.value=!1,y(l))})}})},k=l=>{m.value=!1,y(l)},y=l=>{l&&l.resetFields()},C=(l=!1)=>{l?(o.id=l,X(l).then(e=>{e.code===0&&(o.pid=e.data.pid,o.name=e.data.name,o.description=e.data.description)})):o.id=0,E(),m.value=!0},B=l=>{l?Y(l).then(e=>{e.code===0&&(v.$message.success(e.msg),w())}):v.$message.error("请选择数据ID"),console.log("del",l)},w=()=>{Z().then(l=>{b.value=l.data})},V=c([{id:0,name:"根目录"}]),E=()=>{V.value=[{id:0,name:"根目录"}],$(b.value,V.value,!1)},$=(l,e,d)=>{l&&l.forEach(s=>{if(s.children&&s.children.length){const i={name:s.name,id:s.id,disabled:d||s.id===o.id,children:[]};$(s.children,i.children,d||s.id===o.id),e.push(i)}else{const i={name:s.name,id:s.id,disabled:d||s.id===o.id};e.push(i)}})};return T(()=>{w()}),(l,e)=>{const d=r("Plus"),s=r("el-icon"),i=r("el-button"),f=r("el-form-item"),_=r("el-table-column"),N=r("Edit"),O=r("Filter"),q=r("Delete"),z=r("el-popconfirm"),S=r("el-table"),j=r("el-cascader"),x=r("el-input"),L=r("el-form"),M=r("el-dialog");return I(),K("div",le,[t(f,{label:""},{default:n(()=>[t(i,{type:"primary",onClick:e[0]||(e[0]=a=>C())},{default:n(()=>[t(s,null,{default:n(()=>[t(d)]),_:1}),u(" 新建部门 ")]),_:1})]),_:1}),t(S,{data:b.value,"row-key":"id",height:"var(--global-table)","header-cell-class-name":"global-el-table-header",border:"","highlight-current-row":"","show-overflow-tooltip":"","default-expand-all":""},{default:n(()=>[t(_,{prop:"id",label:"ID",sortable:"",fixed:""}),t(_,{prop:"name",label:"部门名称"}),t(_,{prop:"description",label:"部门简介"}),t(_,{fixed:"right",label:"操作",width:"200"},{default:n(a=>[t(i,{link:"",type:"primary",size:"small",onClick:D=>C(a.row.id)},{default:n(()=>[t(s,null,{default:n(()=>[t(N)]),_:1}),u(" 编辑 ")]),_:2},1032,["onClick"]),t(i,{link:"",type:"primary",size:"small",onClick:D=>g.value=a.row.id},{default:n(()=>[t(s,null,{default:n(()=>[t(O)]),_:1}),u(" 权限设置 ")]),_:2},1032,["onClick"]),a.row.children?G("",!0):(I(),A(z,{key:0,title:"删除后不可恢复，确定删除菜单【"+a.row.name+"】?",onConfirm:D=>B(a.row.id),width:"200"},{reference:n(()=>[t(i,{link:"",type:"primary",size:"small"},{default:n(()=>[t(s,null,{default:n(()=>[t(q)]),_:1}),u(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"]))]),_:1})]),_:1},8,["data"]),t(M,{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=a=>m.value=a),title:o.id?"编辑部门":"新建部门",width:"800",onClose:e[8]||(e[8]=a=>k(p.value))},{footer:n(()=>[H("div",oe,[t(i,{onClick:e[4]||(e[4]=a=>y(p.value))},{default:n(()=>[u("重置")]),_:1}),t(i,{onClick:e[5]||(e[5]=a=>k(p.value))},{default:n(()=>[u("取消")]),_:1}),t(i,{type:"primary",onClick:e[6]||(e[6]=a=>F(p.value))},{default:n(()=>[u("保存")]),_:1})])]),default:n(()=>[t(L,{ref_key:"formRef",ref:p,model:o,rules:U,"status-icon":"","label-position":"top","show-all-levels":!1,inline:""},{default:n(()=>[t(f,{label:"父级部门",prop:"pid",style:{width:"40%"}},{default:n(()=>[t(j,{modelValue:o.pid,"onUpdate:modelValue":e[1]||(e[1]=a=>o.pid=a),options:V.value,props:{expandTrigger:"hover",checkStrictly:!0,value:"id",label:"name",emitPath:!1},style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),t(f,{label:"部门名称",prop:"name",style:{width:"40%"}},{default:n(()=>[t(x,{modelValue:o.name,"onUpdate:modelValue":e[2]||(e[2]=a=>o.name=a)},null,8,["modelValue"])]),_:1}),t(f,{label:"部门简介",prop:"description",style:{width:"40%"}},{default:n(()=>[t(x,{modelValue:o.description,"onUpdate:modelValue":e[3]||(e[3]=a=>o.description=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(ee,{modelValue:g.value,"onUpdate:modelValue":e[9]||(e[9]=a=>g.value=a),type:"sys_department"},null,8,["modelValue"])])}}},ue=te(ne,[["__scopeId","data-v-de2be512"]]);export{ue as default};
