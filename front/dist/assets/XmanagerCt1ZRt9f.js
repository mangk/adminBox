import"./XvueBaz_cZdj.js";import{R as e,o as a,S as l,T as t,U as o,c as i,M as s}from"./X@element-plusRXoBkpEf.js";import{f as n,a as d,b as r,c as u,d as p,e as c}from"./XfileUploadDmMv_Es5.js";import"./XindexCgaQ124S.js";import{u as m}from"./Xqiniu-jsDnNvbc3G.js";import{E as v,a as f}from"./Xelement-plusClartUns.js";import{b as g,ah as h,o as b,c as y,X as j,Q as w,a as x,K as _,W as X,u as k,V as C,P as z,U}from"./X@vuen9TiMG2O.js";import"./XpiniaYeQOi8UL.js";import"./XaxiosDtE8dZ3W.js";import"./XmittCNZ6avp8.js";import"./Xvue-routerzsXVQF6n.js";import"./XnprogressDgs0sPf-.js";import"./Xdayjst441MSVg.js";import"./Xvue3-sfc-loaderDa78GGQm.js";import"./Xlodash-esBg5u8xPa.js";import"./X@vueuseCCX6pF6_.js";import"./X@popperjsD3lHDW-0.js";import"./X@ctrlD2oWfImC.js";import"./Xasync-validatorCuo4gI4y.js";import"./Xmemoize-oneDs0C_khL.js";import"./Xnormalize-wheel-esVn5vHDCm.js";import"./X@floating-uipMauM7H8.js";import"./Xspark-md5LXhfRQWH.js";import"./Xexif-jsCywF333L.js";const T={class:"main-content"},E={class:"file-list-box"},S={class:"el-upload__text",style:{height:"30px","line-height":"30px","text-align":"center",overflow:"hidden",display:"flex","flex-flow":"row nowrap","justify-content":"center"}},V=x("em",null,"点击选择文件",-1),P={class:"el-upload__tip"},q={__name:"manager",setup(q){const A=g({});n().then((e=>{A.value=e.data}));const B=g([]);d().then((e=>{const a=Array.isArray(e.data)?e.data:[];B.value=a}));const I=g(!1),L=g();g(0);const N=g([]),R=g(1),G=g(20),K=g(0),M=g(""),Q=g(""),W=g(""),D=g([]),F=g([]),H=(e=!1)=>{e&&(R.value=1,G.value=20);let a={};M.value&&(a.group_id=M.value),Q.value&&(a.name=Q.value),W.value&&(a.tag=W.value),r(R.value,G.value,a).then((e=>{D.value=e.data.list,R.value=e.data.page,G.value=e.data.page_size,K.value=e.data.total})),F.value=[]},J=async e=>{let a=await u(e.file.name);m(e.file,a.data.key,a.data.token).subscribe((a=>{e.onProgress(a.total)}),(a=>{e.onError(a),setTimeout((()=>{H(!0)}),1500)}),(a=>{e.onSuccess(a),setTimeout((()=>{H(!0)}),1500)}))},O=()=>{L.value.submit()},Y=(e,a)=>{a.findIndex((a=>a.name==e.name))!=a.findLastIndex((a=>a.name==e.name))&&(v.info(e.name+" 已存在于列表中"),a.pop()),N.value=a},Z=e=>{F.value=e.map((e=>e.id))},$=e=>{G.value=e,H()},ee=e=>{R.value=e,H()},ae=e=>{e.id?M.value=e.id:M.value="",H(!0)},le=e=>{p(F.value,e.id).then((e=>{0!=e.code?v.error(e.msg):v.success("移动成功"),H()}))},te=async e=>{switch(e){case"downlaod":D.value.forEach((async e=>{if(F.value.includes(e.id)){const a=document.createElement("iframe");a.style.display="none",a.src=e.url+"?attname=",document.body.appendChild(a),setTimeout((()=>{document.body.removeChild(a)}),5e3)}}));break;case"copyUrl":try{let e="";D.value.forEach((a=>{F.value.includes(a.id)&&(e+=a.url+"\n")})),await navigator.clipboard.writeText(e),v({message:"已复制",type:"success"})}catch(a){v({message:"未授权读取剪贴板",type:"error"})}break;case"delete":f.confirm("删除后文件无法找回！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{c(F.value).then((e=>{0==e.code&&v({message:"已删除",type:"success"}),H()}))}))}};return H(),(n,d)=>{const r=h("el-tree"),u=h("el-col"),p=h("el-button"),c=h("upload-filled"),m=h("el-icon"),v=h("el-upload"),f=h("el-popover"),g=h("el-dropdown-item"),q=h("el-dropdown-menu"),A=h("el-dropdown"),W=h("el-input"),oe=h("el-row"),ie=h("el-table-column"),se=h("el-table"),ne=h("el-pagination");return b(),y("div",T,[j(oe,{gutter:10},{default:w((()=>[j(u,{span:4},{default:w((()=>[j(r,{class:"file-tree-box",data:B.value,props:{label:"name",children:"children"},onNodeClick:ae,"default-expand-all":"","expand-on-click-node":!1,draggable:""},{default:w((({node:e,data:a})=>[x("div",{class:_(a.id==M.value?"self-node node-active":"self-node")},X(e.label),3)])),_:1},8,["data"])])),_:1}),j(u,{span:20},{default:w((()=>[x("div",E,[j(oe,{style:{display:"flex","justify-content":"space-between"}},{default:w((()=>[x("div",null,[j(f,{placement:"bottom-start",width:400,visible:I.value},{reference:w((()=>[j(p,{type:"primary",icon:k(e),onClick:d[0]||(d[0]=e=>I.value=!I.value)},{default:w((()=>[C(" 上传文件 ")])),_:1},8,["icon"])])),default:w((()=>[j(v,{class:"upload-demo",drag:"","auto-upload":!1,ref_key:"fileUploadRef",ref:L,"http-request":J,"file-list":N.value,"onUpdate:fileList":d[1]||(d[1]=e=>N.value=e),"on-change":Y,multiple:""},{trigger:w((()=>[x("div",S,[j(m,{class:"el-icon--upload",style:{"font-size":"25px",margin:"0px var(--global-padding) 0 0"}},{default:w((()=>[j(c)])),_:1}),C(" 将文件拖到此处或"),V])])),tip:w((()=>[x("div",P,[N.value.length?(b(),z(p,{key:0,type:"success",size:"small",icon:k(a),onClick:O},{default:w((()=>[C(" 开始上传 ")])),_:1},8,["icon"])):U("",!0)])])),_:1},8,["file-list"])])),_:1},8,["visible"]),j(A,{disabled:!F.value.length,style:{"margin-left":"10px"},onCommand:te},{dropdown:w((()=>[j(q,null,{default:w((()=>[j(g,{command:"downlaod",icon:k(l)},{default:w((()=>[C("下载文件")])),_:1},8,["icon"]),j(g,{command:"copyUrl",icon:k(t)},{default:w((()=>[C("复制链接")])),_:1},8,["icon"]),j(g,{command:"move",icon:k(o)},{default:w((()=>[j(f,{placement:"right",width:300,trigger:"hover"},{reference:w((()=>[C(" 移动到 ")])),default:w((()=>[j(r,{data:B.value,props:{label:"name",children:"children"},onNodeClick:le,"default-expand-all":"","expand-on-click-node":!1,draggable:""},{default:w((({node:e,data:a})=>[C(X(e.label),1)])),_:1},8,["data"])])),_:1})])),_:1},8,["icon"]),j(g,{command:"delete",icon:k(i),divided:""},{default:w((()=>[C("删除")])),_:1},8,["icon"])])),_:1})])),default:w((()=>[j(p,{disabled:!F.value.length},{default:w((()=>[C(" 批量操作 ")])),_:1},8,["disabled"])])),_:1},8,["disabled"])]),j(W,{modelValue:Q.value,"onUpdate:modelValue":d[3]||(d[3]=e=>Q.value=e),style:{"max-width":"450px"},placeholder:"搜索文件名",clearable:"",class:"input-with-select",onClear:d[4]||(d[4]=e=>H(!0))},{append:w((()=>[j(p,{icon:k(s),onClick:d[2]||(d[2]=e=>H(!0))},null,8,["icon"])])),_:1},8,["modelValue"])])),_:1}),j(se,{data:D.value,"row-key":"id","highlight-current-row":"","show-overflow-tooltip":"",stripe:"",style:{width:"100%","margin-top":"9px","border-top":"1px solid var(--el-table-border-color)",height:"var(--global-table)"},onSelectionChange:Z},{default:w((()=>[j(ie,{type:"selection",width:"55",fixed:""}),j(ie,{prop:"name",label:"文件名",width:"400"}),j(ie,{prop:"url",label:"链接",width:"80"}),j(ie,{prop:"tag",label:"类型",width:"80"}),j(ie,{prop:"group_info.name",label:"分组"}),j(ie,{prop:"ct",label:"创建时间",width:"160"})])),_:1},8,["data"]),j(ne,{"current-page":R.value,"onUpdate:currentPage":d[5]||(d[5]=e=>R.value=e),"page-size":G.value,"onUpdate:pageSize":d[6]||(d[6]=e=>G.value=e),"page-sizes":[20,50,100,200],size:"small",layout:"total, sizes, prev, pager, next, jumper",total:K.value,onSizeChange:$,onCurrentChange:ee},null,8,["current-page","page-size","total"])])])),_:1})])),_:1})])}}};export{q as default};
