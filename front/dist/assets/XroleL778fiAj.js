import{r as d,a as D,o as G,c as i,d as U,e as H,f as t,w as a,h as u,k as J,l as K,g as L,j as O}from"./XindexDjbqw_om.js";import{r as Q,a as W,b as X,c as Y,d as Z}from"./XroleCvc7f126.js";import ee from"./XpremissionSetuvlfXZTk.js";import"./X_plugin-vue_export-helperDlAUqK2U.js";const te={class:"main-content"},le={class:"dialog-footer"},re={__name:"role",setup(oe){const g=d(0),{proxy:b}=O(),w=d([]),m=d(1),p=d(20),V=d(0),c=d(!1),f=d(),n=D({id:0,name:"",description:""}),P=D({name:[{required:!0,message:"角色名称 不能为空",trigger:"blur"}]}),_=()=>{Q(m.value,p.value).then(l=>{w.value=l.data.list,m.value=l.data.page,p.value=l.data.page_size,V.value=l.data.total})},S=l=>{p.value=l,_()},F=l=>{m.value=l,_()},z=(l=!1)=>{l?(n.id=l,W(l).then(e=>{e.code===0&&(n.id=e.data.id,n.name=e.data.name,n.description=e.data.description)})):n.id=0,c.value=!0},I=l=>{l?X(l).then(e=>{e.code===0&&(b.$message.success(e.msg),_())}):b.$message.error("请选择数据ID"),console.log("del",l)},B=async l=>{l&&await l.validate((e,y)=>{if(!e)console.log("error submit!",y);else{let r={};console.log(n.id),n.id?r=Y(n):r=Z(n),r.then(s=>{s.code===0&&(b.$message.success(s.msg),_(),c.value=!1,C(l))})}})},$=l=>{c.value=!1,C(l)},C=l=>{l&&l.resetFields()};return G(()=>{_()}),(l,e)=>{const y=i("Plus"),r=i("el-icon"),s=i("el-button"),k=i("el-form-item"),v=i("el-table-column"),N=i("Edit"),j=i("Filter"),q=i("Delete"),R=i("el-popconfirm"),A=i("el-table"),M=i("el-pagination"),h=i("el-input"),T=i("el-form"),E=i("el-dialog");return U(),H("div",te,[t(k,{label:""},{default:a(()=>[t(s,{type:"primary",onClick:e[0]||(e[0]=o=>z())},{default:a(()=>[t(r,null,{default:a(()=>[t(y)]),_:1}),u(" 新建角色 ")]),_:1})]),_:1}),t(A,{data:w.value,"row-key":"id",height:"var(--global-table)",border:"","highlight-current-row":"","show-overflow-tooltip":""},{default:a(()=>[t(v,{prop:"id",label:"ID",sortable:"",fixed:"",width:"80"}),t(v,{prop:"name",label:"角色名称",width:"260"}),t(v,{prop:"description",label:"角色描述"}),t(v,{fixed:"right",label:"操作",width:"200"},{default:a(o=>[t(s,{link:"",type:"primary",size:"small",onClick:x=>z(o.row.id)},{default:a(()=>[t(r,null,{default:a(()=>[t(N)]),_:1}),u(" 编辑 ")]),_:2},1032,["onClick"]),t(s,{link:"",type:"primary",size:"small",onClick:x=>g.value=o.row.id},{default:a(()=>[t(r,null,{default:a(()=>[t(j)]),_:1}),u(" 权限设置 ")]),_:2},1032,["onClick"]),o.row.children?K("",!0):(U(),J(R,{key:0,title:"删除后不可恢复，确定删除API【"+o.row.name+"】?",onConfirm:x=>I(o.row.id),width:"200"},{reference:a(()=>[t(s,{link:"",type:"primary",size:"small"},{default:a(()=>[t(r,null,{default:a(()=>[t(q)]),_:1}),u(" 删除 ")]),_:1})]),_:2},1032,["title","onConfirm"]))]),_:1})]),_:1},8,["data"]),t(M,{"current-page":m.value,"onUpdate:currentPage":e[1]||(e[1]=o=>m.value=o),"page-size":p.value,"onUpdate:pageSize":e[2]||(e[2]=o=>p.value=o),"page-sizes":[20,50,100,200],size:"small",layout:"total, sizes, prev, pager, next, jumper",total:V.value,onSizeChange:S,onCurrentChange:F},null,8,["current-page","page-size","total"]),t(E,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=o=>c.value=o),title:n.id?"编辑角色":"新建角色",width:"800",onClose:e[9]||(e[9]=o=>$(f.value))},{footer:a(()=>[L("div",le,[t(s,{onClick:e[5]||(e[5]=o=>C(f.value))},{default:a(()=>[u("重置")]),_:1}),t(s,{onClick:e[6]||(e[6]=o=>$(f.value))},{default:a(()=>[u("取消")]),_:1}),t(s,{type:"primary",onClick:e[7]||(e[7]=o=>B(f.value))},{default:a(()=>[u("保存")]),_:1})])]),default:a(()=>[t(T,{ref_key:"formRef",ref:f,model:n,rules:P,"status-icon":"","label-position":"top","show-all-levels":!1},{default:a(()=>[t(k,{label:"角色名称",prop:"name"},{default:a(()=>[t(h,{modelValue:n.name,"onUpdate:modelValue":e[3]||(e[3]=o=>n.name=o)},null,8,["modelValue"])]),_:1}),t(k,{label:"角色描述",prop:"description"},{default:a(()=>[t(h,{modelValue:n.description,"onUpdate:modelValue":e[4]||(e[4]=o=>n.description=o)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(ee,{modelValue:g.value,"onUpdate:modelValue":e[10]||(e[10]=o=>g.value=o),type:"sys_role"},null,8,["modelValue"])])}}};export{re as default};
